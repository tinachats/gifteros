var start = 0;
var limit = 8;
var status = 'inactive';
var _token = $('input[name="_token"]').val();

// Date and time functions
var today = new Date();
var user_time = ("0" + today.getHours()).slice(-2);
var date = ("0" + today.getDate()).slice(-2);
var mnth = ("0" + today.getMonth()).slice(-2);
var year = today.getFullYear();
var day = new Array();
day[0] = 'Sunday';
day[1] = 'Monday';
day[2] = 'Tuesday';
day[3] = 'Wednesday';
day[4] = 'Thursday';
day[5] = 'Friday';
day[6] = 'Saturday';

var d = day[today.getDay()];

var month = new Array();
month[0] = 'January';
month[1] = 'February';
month[2] = 'March';
month[3] = 'April';
month[4] = 'May';
month[5] = 'June';
month[6] = 'July';
month[7] = 'August';
month[8] = 'September';
month[9] = 'October';
month[10] = 'November';
month[11] = 'December';

$(function() {
    // $.ajaxSetup({ headers: { 'csrf-token': '{{ csrf_token()' } });

    // Change profile picture
    $(document).on('change', '#profile-pic', function(e) {
        e.stopPropagation();
        var property = this.files[0];
        var profile_pic = property.name;
        var ext = profile_pic.split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'jfif', 'png', 'jpg', 'jpeg']) == -1) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file type not allowed!',
                messageColor: '#000',
                position: 'center'
            });
        }
        var img_size = property.size;
        if (img_size > 5000000) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file too large!',
                messageColor: '#000',
                position: 'center'
            });
        } else {
            var form_data = new FormData();
            form_data.append('profile-pic', property);
            form_data.append('_token', _token);
            $.ajax({
                url: '/profile_pic',
                method: 'post',
                data: form_data,
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function() {
                    $('.line').css('display', 'block');
                },
                success: function(response) {
                    if (response) {
                        $('.line').css('display', 'none');
                        iziToast.show({
                            theme: 'dark',
                            timeout: 2000,
                            closeOnClick: true,
                            overlay: false,
                            close: false,
                            backgroundColor: 'var(--success)',
                            progressBar: false,
                            icon: 'ion-checkmark text-light',
                            message: response.message,
                            messageColor: '#fff',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Change cover page image
    $(document).on('change', '#cover-img', function(e) {
        e.stopPropagation();
        var property = this.files[0];
        var cover_page = property.name;
        var ext = cover_page.split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'jfif', 'png', 'jpg', 'jpeg']) == -1) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file type not allowed!',
                messageColor: '#000',
                position: 'center'
            });
        }
        var img_size = property.size;
        if (img_size > 5000000) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file too large!',
                messageColor: '#000',
                position: 'center'
            });
        } else {
            var form_data = new FormData();
            form_data.append('cover-img', property);
            form_data.append('_token', _token);
            $.ajax({
                url: '/cover_page',
                method: 'post',
                data: form_data,
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function() {
                    $('.line').css('display', 'block');
                },
                success: function(response) {
                    if (response) {
                        $('.line').css('display', 'none');
                        iziToast.show({
                            theme: 'dark',
                            timeout: 2000,
                            closeOnClick: true,
                            overlay: false,
                            close: false,
                            backgroundColor: 'var(--success)',
                            progressBar: false,
                            icon: 'ion-checkmark text-light',
                            message: response.message,
                            messageColor: '#fff',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Update personal details
    $('#user-info').on('submit', function(e) {
        e.preventDefault();
        var action = 'update-profile';
        var address = $('#address').val();
        var birth_date = $('.birthday-date').val();
        var birth_month = $('.birth-month').val();
        var birth_year = $('.birth-year').val();
        var birthday = `${birth_year}/${birth_month}/${birth_date}`;
        var city = $('#city').val();
        var email = $('#email').val();
        var name = $('#name').val();
        var mobile_phone = $('#mobile-phone').val();
        $.ajax({
            url: '/account/update',
            method: 'post',
            data: {
                action: action,
                address: address,
                bithday: birthday,
                city: city,
                email: email,
                name: name,
                mobile_phone: mobile_phone,
                _token: _token
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'updated') {
                    $('#user-info').removeClass('was-validated');
                    userProfile();
                    iziToast.show({
                        theme: 'dark',
                        timeout: 2000,
                        closeOnClick: true,
                        backgroundColor: 'var(--success)',
                        progressBar: false,
                        overlay: false,
                        icon: 'ion-checkmark text-light',
                        message: 'Profile successfully updated.',
                        messageColor: '#fff',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Oops! Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    });

    // Change account password
    $('#change-password').on('submit', function(e) {
        e.preventDefault();
        var new_password = $('#new-password').val();
        var confirm_password = $('#confirm-password').val();
        var errors = false;

        if (new_password == '' || confirm_password == '') {
            $('#new-password-error').text('New password required!');
            $('#confirm-error').text('Field cannot be blank!');
            $('#new-password').addClass('is-invalid');
            $('#confirm-password').addClass('is-invalid');
            $('#new-password-error').show();
            $('#confirm-error').show();
            $('#change-password-btn').attr('type', 'button');
            errors = true;
        }

        if (new_password !== confirm_password) {
            $('#new-password-error').text('Passwords do not match!');
            $('#confirm-error').text('Passwords do not match!');
            $('#new-password').removeClass('is-valid');
            $('#confirm-password').removeClass('is-valid');
            $('#new-password').addClass('is-invalid');
            $('#confirm-password').addClass('is-invalid');
            $('#new-password-error').show();
            $('#confirm-error').show();
            errors = true;
        } else {
            $('#new-password-error').hide();
            $('#confirm-error').hide();
            $('#new-password').removeClass('is-invalid');
            $('#confirm-password').removeClass('is-invalid');
        }

        if (errors == false) {
            var action = 'change-password';
            $.ajax({
                url: '/account/change_password',
                method: 'post',
                data: {
                    action: action,
                    new_password: new_password,
                    _token: _token
                },
                success: function(data) {
                    if (data.message == 'success') {
                        $('#change-password').removeClass('was-validated');
                        $('#change-password').removeClass('was-validated');
                        $('#change-password')[0].reset();
                        iziToast.show({
                            theme: 'dark',
                            timeout: 5000,
                            overlay: false,
                            icon: 'ion ion-checkmark text-light',
                            backgroundColor: 'var(--success)',
                            message: 'Password successfully changed!',
                            position: 'center'
                        });
                    } else {
                        iziToast.warning({
                            theme: 'dark',
                            timeout: 5000,
                            closeOnClick: true,
                            close: false,
                            progressBar: false,
                            backgroundColor: 'var(--warning)',
                            icon: 'ion-android-alert text-dark',
                            message: 'Oops! Something went wrong!',
                            messageColor: '#000',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Joining the mailing list
    $('#subscription-form').on('submit', function(e) {
        e.preventDefault();
        var form_data = $(this).serialize();
        $.ajax({
            url: '/subscribe',
            method: 'post',
            data: form_data,
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    $('#subscription-form').removeClass('was-validated');
                    $('#mailing-list').modal('hide');
                    localStorage.setItem('newsletter', 'subscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'You\'ve successfully subscribed to our newsletter!',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    });

    // Gift search suggestions
    $(document).on('keyup', '#search', function() {
        let search = $(this).val();
        let val = search.length;
        if (val > 0) {
            $('.line').css('display', 'block');
            $('#search-list').css('display', 'block');
            $.ajax({
                url: '/search',
                method: 'get',
                data: {
                    search: search
                },
                dataType: 'json',
                success: function(data) {
                    $('#search-list').html(data.results);
                    userCurrency();
                }
            });
        } else {
            $('.line').css('display', 'none');
            $('#search-list').css('display', 'none');
        }
    });

    // Checking if user has accepted the cookie policy or not
    let cookie_policy = localStorage.getItem('cookie-policy');
    if (cookie_policy !== '' && cookie_policy == 'agreed') {
        $('.policy-banner').hide();
    } else {
        $('.policy-banner').show();
    }

    $(document).on('click', '.cookie-policy-btn', function(e) {
        e.preventDefault();
        localStorage.setItem('cookie-policy', 'agreed');
        $('.policy-banner').addClass('animated animate-slow slideOutRight');
        $('.policy-banner').show();
    });

    /*** App's Methods & Functions ***/
    setTimeout(() => {
        userCurrency();
    }, 500);

    // Create a storage class to handle all localStorage functions
    class Storage {
        static userData() {
            let data = localStorage.getItem('user-data');
            let user_data;
            if (data === null) {
                user_data = [];
            } else {
                user_data = JSON.parse(localStorage.getItem('user-data'));
            }
            return user_data;
        }
        static getTheme() {
                let theme = localStorage.getItem('theme');
                let theme_setting;
                if (theme) {
                    if (theme === 'darkmode') {
                        theme_setting = 'darkmode';
                    } else {
                        theme_setting = 'default';
                    }
                } else {
                    theme_setting = 'default';
                }
                return theme_setting;
            }
            // Get all viewed products
        static getViewedItems() {
            let viewed_products;
            if (localStorage.getItem('viewed-products') === null) {
                viewed_products = [];
            } else {
                viewed_products = JSON.parse(localStorage.getItem('viewed-products'));
            }
            return viewed_products;
        }
    }

    // Fetch user data from the localStorage
    userPreferences();

    function userPreferences() {
        // Get user's theme mode
        appTheme();

        // Fetch user's products view option
        let view_option = localStorage.getItem('view-option');

        if (view_option !== null) {
            if (view_option === 'grid-view') {
                $('.grid-icon').addClass('active');
                $('.list-icon').removeClass('active');
                if ($('.products-shelf').hasClass('grid-view')) {
                    $('.products-shelf').removeClass('list-view');
                } else {
                    $('.products-shelf').removeClass('list-view');
                    $('.products-shelf').addClass('grid-view');
                }
            } else if (view_option === 'list-view') {
                $('.grid-icon').removeClass('active');
                $('.list-icon').addClass('active');
                if ($('.products-shelf').hasClass('list-view')) {
                    $('.products-shelf').removeClass('grid-view');
                } else {
                    $('.products-shelf').removeClass('grid-view');
                    $('.products-shelf').addClass('list-view');
                }
            }
        } else {
            $('.grid-icon').addClass('active');
            $('.list-icon').removeClass('active');
            $('.products-shelf').removeClass('list-view');
        }

        // Determine if user is registered or not
        var user_data = Storage.userData();
        if (user_data.length !== 0) {
            $('.visitor').toggleClass('d-none');
        } else {
            $('.registered-user').toggleClass('d-none');
        }

        // Get user newsletter subscription
        var newsletter = localStorage.getItem('newsletter');
        if (newsletter) {
            if (newsletter == 'subscribed') {
                $('#newsletter').attr('checked', true);
            } else {
                $('#newsletter').attr('checked', false);
            }
        } else {
            $('#newsletter').attr('checked', false);
        }
    }

    // Fetch user's app theme
    function appTheme() {
        let theme = Storage.getTheme();
        if (theme === 'darkmode') {
            $('body').toggleClass('darkmode');
            $('.main-sidebar').toggleClass('bg-meshgrid');
            $('.settings-bar').toggleClass('bg-meshgrid');
            $('.theme-switch').attr('checked', true);
        } else {
            $('.theme-switch').attr('checked', false);
        }
    }

    $('#toggle-mailing-list').on('click', function() {
        var newsletter = localStorage.getItem('newsletter');
        if (newsletter) {
            if (newsletter == 'subscribed') {
                $('#newsletter').attr('checked', true);
                $('#mailing-list').modal('hide');
                $('#subscribed-modal').modal('show');
            } else {
                $('#newsletter').attr('checked', false);
                $('#mailing-list').modal('show');
                $('#subscribed-modal').modal('hide');
            }
        } else {
            $('#newsletter').attr('checked', false);
            $('#mailing-list').modal('show');
            $('#subscribed-modal').modal('hide');
        }
    });

    // Hide the gradient progress bar when page is loaded
    $('.line').hide();

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    // App Rating
    $('.toggle-ratingbox').on('click', function(e) {
        e.preventDefault();
        $('.app-rating-box').toggleClass('show');
        $('.main-sidebar').removeClass('show');
        $('.app-backdrop').addClass('d-none');
    });

    //Get the button
    $(window).on('scroll', function() {
        if ($(document).height() >= $(window).height()) {
            $('#scroll-top').css('display', 'block');
        } else {
            $('#scroll-top').css('display', 'none');
        }
    });

    // Scroll to the bottom of the page
    function scrollToBottom() {
        $('html, body').animate({
            scrollTop: document.body.scrollHeight
        }, 'slow');
    }

    // Input masks
    $('[data-mask]').inputmask();

    // Enable popovers and tooltips
    $('[data-toggle="popover"]').popover();
    $('[data-toggle="tooltip"]').tooltip();

    // Toggle the active class when icon-links are clicked
    $('.icon-link').on('click', function() {
        $('.icon-link').not(this).removeClass('active');
        $(this).addClass('active');
    });

    // Toggle the mega-menu
    $('.mega-item').on('mouseenter', function(e) {
        $('.mega-menu').addClass('show');
    });

    $('.mega-menu').on('mouseleave', function(e) {
        $('.mega-menu').removeClass('show');
    });

    // Stop propagation
    $('.user-menu').on('click', function(e) {
        e.stopPropagation();
    });

    // Toggle Reviews
    $('.toggle-reviews').on('click', function(e) {
        e.preventDefault();
        $('#product-reviews').slideToggle('slow');
        $('.view-reviews').toggleClass('d-none');
    });

    // Toggling view-options
    $('.view-option').on('click', function() {
        var view_option = $(this).data('view');

        if (view_option === 'grid-view') {
            if ($('.products-shelf').hasClass('grid-view')) {
                $('.products-shelf').removeClass('list-view');
            } else {
                $('.products-shelf').removeClass('list-view');
                $('.products-shelf').addClass('grid-view');
            }
            $('.list-icon').removeClass('active');
            $('.grid-icon').addClass('active');
        } else if (view_option === 'list-view') {
            if ($('.products-shelf').hasClass('list-view')) {
                $('.products-shelf').removeClass('grid-view');
            } else {
                $('.products-shelf').removeClass('grid-view');
                $('.products-shelf').addClass('list-view');
            }
            $('.grid-icon').removeClass('active');
            $('.list-icon').addClass('active');
        }

        // Save the user's option in local storage
        localStorage.setItem('view-option', view_option);
    });

    // Toggle sidebar
    $('.menu-btn').on('click', function() {
        $('.main-sidebar').toggleClass('show').focus();
        $('.app-backdrop').toggleClass('d-none');
    });

    $('.main-sidebar').on('focusout', function() {
        $('.main-sidebar').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Toggle Search result box
    $(document).on('mouseup', function(e) {
        var search_list = $('#search-list');
        if (!search_list.is(e.target) && search_list.has(e.target).length === 0) {
            search_list.hide();
            $('#search').val('');
            $('.line').css('display', 'none');
        }
    });

    // Toggle settings sidebar
    $('.toggle-settings').on('click', function(e) {
        e.stopPropagation();
        $('.settings-bar').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Comparing Products
    $(document).on('click', '.compare-btn', function() {
        // Get product details
        var gift_id = $(this).data('id');
        var gift_name = $(this).data('name');
        var gift_image = $('#image' + gift_id).val();
        var usd_price = $('#usd-price' + gift_id).val();
        var zar_price = $('#zar-price' + gift_id).val();
        var zwl_price = $('#zwl-price' + gift_id).val();
        var product_category = $('#category-name' + gift_id).val();
        var product_quantity = $('#quantity' + gift_id).val();
        var product_units = $('#product-units' + gift_id).val();
        var product_description = $('#description' + gift_id).val();
        var action = 'compare-item';

        if ($('#compare-btn' + gift_id).hasClass('active')) {
            $('#compare-btn' + gift_id).removeClass('active');
            $('#compare-btn' + gift_id).html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
            var product = document.querySelector('#product-pane' + gift_id);
            // Replace the product's pane with the placeholder plane
            const placeholder_pane = document.createElement('div');
            placeholder_pane.classList = 'product-pane empty box-shadow-sm';
            placeholder_pane.innerHTML = `
                <div class="empty-content text-center p-2">
                    <p class="text-sm mb-0 pb-0 text-white">
                        Add product to compare
                    </p>
                    <div class="row justify-content-center">
                        <div class="d-flex align-items-center text-white rounded-0 mt-1">
                            <i class="material-icons mr-1">compare_arrows</i> Compare
                        </div>
                    </div>
                </div>
            `;
            let product_pane = document.querySelector('.compare-products');
            product_pane.replaceChild(placeholder_pane, product);
        } else {
            $('#compare-btn' + gift_id).addClass('active');
            $('#compare-btn' + gift_id).html('<i class="material-icons mr-1">done</i> Selected');
            // Create compare product
            let product_pane = document.querySelector('.compare-products');
            let product = document.createElement('div');
            product.classList = 'product-pane filled box-shadow-sm';
            product.id = 'product-pane' + gift_id;
            product.innerHTML = `
                <div class="media p-2">
                    <span role="button" class="material-icons text-danger remove-comparison" id="${gift_id}" title="Remove product">cancel</span>
                    <img src="/storage/gifts/${gift_image}" height="80" width="80" alt="${gift_name}">
                    <div class="media-body lh-100 ml-2">
                        <p class="text-sm text-capitalize comparison-title font-600 text-faded my-0 py-0">
                            ${gift_name}
                        </p>
                        <p class="text-sm text-capitalize text-primary my-0 py-0">
                            ${product_category}
                        </p>
                        <p class="font-600 text-blue usd-price mt-4">US$${usd_price}</p>
                        <p class="font-600 text-blue zar-price d-none mt-4">R${zar_price}</p>
                        <p class="font-600 text-blue zwl-price d-none mt-4">ZW$${zwl_price}</p>
                    </div>
                </div>
            `;
            let placeholder_pane = document.querySelector('.product-pane.empty');
            product_pane.replaceChild(product, placeholder_pane);

            // Check if comparison-panels are above 1
            comparisons();
        }
    });

    // Close the comparisons panel when close icon is clicked
    $(document).on('click', '#close-panel', function() {
        if ($('.comparison-pane').hasClass('hide')) {
            $('.comparison-pane').removeClass('hide');
            $('.comparison-pane').addClass('hide');
        } else {
            $('.comparison-pane').addClass('hide');
        }

        // Remove all filled product panes
        const product_panes = document.querySelectorAll('.filled');
        for (const product_pane of product_panes) {
            // Replace the product pane with the placeholder plane
            const placeholder_pane = document.createElement('div');
            placeholder_pane.classList = 'product-pane empty box-shadow-sm';
            placeholder_pane.innerHTML = `
                <div class="empty-content text-center p-2">
                    <p class="text-sm mb-0 pb-0 text-white">
                        Add product to compare
                    </p>
                    <div class="row justify-content-center">
                        <div class="d-flex align-items-center text-white rounded-0 mt-1">
                            <i class="material-icons mr-1">compare_arrows</i> Compare
                        </div>
                    </div>
                </div>
            `;
            const compare_panel = document.querySelector('.compare-products');
            compare_panel.replaceChild(placeholder_pane, product_pane);
        }

        // Clear the comparison session
        var action = 'clear-comparisons';
        $.ajax({
            url: '/account/change_password',
            method: 'post',
            data: { action: action },
            success: function(data) {
                if (data == 'session-cleared') {
                    $('.compare-btn').attr('disabled', false);
                    $('.compare-btn').removeClass('active');
                    $('.compare-btn').html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
                }
            }
        });
    });

    // Remove product comparison
    $(document).on('click', '.remove-comparison', function() {
        var gift_id = $(this).attr('id');
        var product = document.querySelector('#product-pane' + gift_id);
        // Replace the product's pane with the placeholder plane
        const placeholder_pane = document.createElement('div');
        placeholder_pane.classList = 'product-pane empty box-shadow-sm';
        placeholder_pane.innerHTML = `
            <div class="empty-content text-center p-2">
                <p class="text-sm mb-0 pb-0 text-white">
                    Add product to compare
                </p>
                <div class="row justify-content-center">
                    <div class="d-flex align-items-center text-white rounded-0 mt-1">
                        <i class="material-icons mr-1">compare_arrows</i> Compare
                    </div>
                </div>
            </div>
        `;
        let product_pane = document.querySelector('.compare-products');
        product_pane.replaceChild(placeholder_pane, product);
        // remove the product item form the comparison session
        var action = 'remove-product-comparison';
        comparisons();
        $.ajax({
            url: '/account/change_password',
            method: 'post',
            data: {
                action: action,
                gift_id: gift_id
            },
            success: function() {
                $('.compare-btn').attr('disabled', false);
                $('#compare-btn' + gift_id).removeClass('active');
                $('#compare-btn' + gift_id).html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
            }
        });
    });

    // Submit products to compare
    $(document).on('submit', '#compare-form', function(e) {
        e.preventDefault();
        window.location.href = 'comparisons.php';
    });

    // Expire the compare products session
    $('.expire-session').on('click', function() {
        var action = 'clear-comparisons';
        $.ajax({
            url: '/account/change_password',
            method: 'post',
            data: { action: action },
            success: function(data) {
                if (data == 'session-cleared') {
                    window.location.href = 'index.php';
                    $('.compare-btn').attr('disabled', false);
                }
            }
        });
    });

    function comparisons() {
        // Loop through all filled product-panes to enable the submit button
        products = document.querySelectorAll('.filled');
        if (products !== '') {
            for (var i = 0; i < products.length; i++) {
                if (i == 0) {
                    $('.comparison-pane').removeClass('d-none hide');
                }
                if (i == 1) {
                    $('#submit-comparisons').attr('disabled', false);
                }
                if (i > 1) {
                    $('.compare-btn').attr('disabled', true);
                    // Scroll to the bottom of the page if there're products to compare
                    scrollToBottom();
                }
                if (i >= 2) {
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--dark-blue)',
                        icon: 'ion-information-circled text-white-inverse',
                        message: 'Only max. 3 comparisons allowed',
                        messageColor: 'var(--white-inverse)',
                        position: 'center'
                    });
                }
            }
        } else {
            $('.comparison-pane').addClass('hide d-none');
            $('#submit-comparisons').attr('disabled', true);
            var action = 'clear-comparisons';
            $.ajax({
                url: '/account/change_password',
                method: 'post',
                data: { action: action },
                success: function(data) {
                    if (data == 'session-cleared') {
                        $('.comparison-pane').addClass('hide d-none');
                        $('.compare-btn').removeClass('d-flex align-items-center justify-content-center active');
                        $('.compare-btn').html('Compare');
                    }
                }
            });
        }
    }

    // Wishlist actions
    $(document).on('click', '.wishlist-icon', function() {
        var gift_id = $(this).data('id');
        var user_id = $(this).data('user');
        var action = $(this).data('action');
        $.ajax({
            url: `/${action}`,
            method: 'post',
            data: {
                action: action,
                gift_id: gift_id,
                user_id: user_id,
                _token: _token
            },
            dataType: 'json',
            success: function(data) {
                iziToast.show({
                    theme: 'dark',
                    timeout: 2000,
                    closeOnClick: true,
                    overlay: false,
                    close: false,
                    progressBar: false,
                    backgroundColor: 'var(--success)',
                    icon: 'ion-checkmark text-light',
                    message: data.message,
                    messageColor: '#fff',
                    position: 'topCenter'
                });
                showcase();
                userInfo();
                myWishlist();
            }
        });
    });

    // Toggle the wishlist modal if user is not signed in
    $(document).on('click', '.guest-wishes', function() {
        var gift_id = $(this).attr('id');
        var gift_name = $(this).data('name');
        console.log(gift_id, gift_name);
        $('#wishlist-modal').modal('show');
        $('#visitor-wish-item').html(gift_name);
    });

    // View notifications
    $(document).on('click', '.notifications', function() {
        $('.notifications-counter').html('');
        notifications('read');
        notificationsList();
    });

    /*** Details page functions and methods ***/

    // Toggling the yellow glow on mous-enter on an accessory
    $(document).on('mouseenter', '.greeting-card-img', function() {
        $('.greeting-card-img').not(this).removeClass('card-glow');
        $(this).addClass('card-glow');
    });

    $(document).on('mouseleave', '.greeting-card-img', function() {
        $('.greeting-card-img').not(this).removeClass('card-glow');
        $(this).removeClass('card-glow');
    });

    // Hide the rating success modal
    $(document).on('click', '#dismiss-success-modal', function() {
        window.location.reload();
        $('#success-modal').modal('hide');
    });

    //initiate the plugin and pass the id of the div containing gallery images
    $('#product-img').elevateZoom({
        gallery: 'gallery',
        cursor: 'pointer',
        galleryActiveClass: 'active',
        imageCrossfade: true,
        tint: true,
        tintColour: '#006effaf',
        tintOpacity: 0.5
    });

    //pass the images to Fancybox
    $("#product-img").bind("click", function(e) {
        var ez = $('#product-img').data('elevateZoom');
        $.fancybox(ez.getGalleryList());
        return false;
    });

    // Show review modal
    $('#show-write-review').on('click', function() {
        $('#write-review').modal('show');
        $('#product-name').text(gift_name);
    });

    // User product_rating rating
    $("#user-rating").rateYo({
        onSet: function(rating, rateYoInstance) {
            $(this).next().text('Rating of ' + rating);
            $('#star-rating').val(rating);
        },
        normalFill: "#A0A0A0",
        maxValue: 5,
        starWidth: "20px",
        spacing: "10px"
    });

    // Wishlist actions
    $(document).on('click', '.details-wishlist-btn', function() {
        var gift_id = $(this).data('id');
        var user_id = $(this).data('user');
        var action = $(this).data('action');
        wishlistGift(action, gift_id, user_id);
    });

    // Click on the helpful button
    $(document).on('click', '.helpful-btn', function() {
        var rating_id = $(this).data('post');
        var gift_id = $(this).data('id');
        var action = $(this).data('action');
        postHelpful(action, gift_id, rating_id);
    });

    // Click on the unhelpful button
    $(document).on('click', '.unhelpful-btn', function() {
        var rating_id = $(this).data('post');
        var gift_id = $(this).data('id');
        var action = $(this).data('action');
        postUnhelpful(action, gift_id, rating_id);
    });

    // Toggle comment section
    $(document).on('click', '.toggle-comments', function() {
        post_id = $(this).data('post_id');
        user_id = $(this).data('user_id');
        toggleComments(post_id, user_id);
    });

    // Delivery date functions
    const now = new Date().getDate();
    const minDate = new Date(new Date().setDate(now - 1));
    const maxDate = new Date(new Date().setFullYear(year - 15, mnth, date));
    date_placeholder = 'Sat, Jul 20';
    $('#delivery-date').attr('placeholder', date_placeholder);
    $('.datepicker').datepicker({
        showOtherMonths: true,
        modal: true,
        header: true,
        footer: true,
        format: 'ddd, mmm dd',
        minDate: minDate
    });

    // Dismiss success modal
    $('#dismiss-success-modal').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $('#success-modal').modal('hide');
    });

    /*** Carousel sliders ***/
    // Owl Carousel navigation icons
    const prevIcon = '<img src="../../img/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
    const nextIcon = '<img src="../../img/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';
    const prev = '<img src="../../img/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
    const next = '<img src="../../img/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';
    $('.target-gifts').owlCarousel({
        loop: false,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        responsive: {
            0: {
                items: 1,
                dots: true,
            },
            320: {
                items: 2,
                dots: true,
            },
            576: {
                items: 2,
                dots: false,
            },
            768: {
                items: 3,
                dots: false,
            },
            992: {
                items: 4,
                dots: false,
            },
            1024: {
                items: 4,
                dots: false,
            },
            1200: {
                items: 6,
                dots: false,
            }
        },
        autoplay: false
    });
    $('.carousel-autoplay').owlCarousel({
        loop: true,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        lazyLoad: true,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 4
            },
            1024: {
                items: 4
            },
            1200: {
                items: 6
            }
        },
        autoplay: true
    });
    $('.reviews-carousel').owlCarousel({
        loop: true,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 1
            },
            576: {
                items: 1
            },
            768: {
                items: 2
            },
            992: {
                items: 2
            },
            1024: {
                items: 2
            },
            1200: {
                items: 3
            }
        },
        autoplay: true
    });
    $('.category-filters').owlCarousel({
        loop: false,
        stagePadding: 10,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        nav: true,
        navText: [
            prev,
            next
        ],
        dots: false,
        responsive: {
            0: {
                items: 2
            },
            320: {
                items: 2
            },
            576: {
                items: 4
            },
            768: {
                items: 4
            },
            992: {
                items: 5
            },
            1024: {
                items: 5
            },
            1200: {
                items: 7
            }
        },
        autoplay: false
    });
    $('.showcase-carousel').owlCarousel({
        loop: true,
        navRewind: true,
        nav: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        autoplay: true,
        items: 1,
        responsive: {
            0: {
                dots: true
            },
            320: {
                dots: true
            },
            576: {
                dots: true
            },
            768: {
                dots: false
            },
            992: {
                dots: false
            },
            1024: {
                dots: false
            },
            1200: {
                dots: false
            }
        },
    });
    /*** /.Carousel sliders ***/
});

// Fetch all gift categories
function showcase() {
    var action = 'showcase';
    $.ajax({
        url: '/showcase',
        method: 'post',
        data: {
            action: action,
            _token: _token
        },
        dataType: 'json',
        beforeSend: giftsPreloader(),
        success: function(data) {
            $('#customizable-gifts').html(data.customized_gifts);
            $('#kitchenware').html(data.kitchenware);
            $('#personal-care-gifts').html(data.personal_care);
            $('#plasticware').html(data.plasticware);
            $('#combo-gifts').html(data.combo_gifts);
            $('#appliances').html(data.appliances);
        }
    });
}

// Fetch user's profile details
function userProfile() {
    var action = 'user-profile';
    $.ajax({
        url: '/account/data',
        method: 'post',
        data: {
            action: action,
            _token: _token
        },
        dataType: 'json',
        success: function(data) {
            $('#user-data').html(data.user_data);
            $('#gift-reviews').html(data.gift_reviews);
            $('.count-user-reviews').text(data.count_reviews);
        }
    });
}

// Check if user current password is the same with the registered one
function checkPassword(obj) {
    var password = obj.value;
    var action = 'check-password';

    if (password.length > 0) {
        $.ajax({
            url: '/account/check_password',
            method: 'post',
            data: {
                action: action,
                password: password,
                _token: _token
            },
            success: function(data) {
                if (data.message == 'correct') {
                    $('#change-password').removeClass('was-validated');
                    $('#password').removeClass('is-invalid');
                    $('#password').addClass('is-valid');
                    $('#password-error').hide();
                    $('.new-credentials').slideToggle('slow');
                    $('#change-password-btn').attr('type', 'submit');
                } else {
                    $('#password').addClass('is-invalid');
                    $('#password').removeClass('is-valid');
                    $('#password-error').removeClass('valid-feedback');
                    $('#password-error').addClass('invalid-feedback');
                    $('#password-error').text('Password is incorrect!');
                    $('#password-error').show();
                }
            }
        });
    } else {
        $('#password-error').removeClass('valid-feedback');
        $('#password-error').addClass('invalid-feedback');
        $('#password-error').show();
    }
}

// Newletter subscription
function subscribe(obj) {
    var subscribed = obj.checked;
    if (subscribed) {
        var action = 'subscribe';
        $.ajax({
            url: '/maiing_list',
            method: 'post',
            data: {
                action: action,
                _token: _token
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    localStorage.setItem('newsletter', 'subscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'You\'ve successfully subscribed to our newsletter!',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    } else {
        var action = 'unsubscribe';
        $.ajax({
            url: '/unsubscribe',
            method: 'post',
            data: {
                action: action,
                _token: _token
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    localStorage.setItem('newsletter', 'unsubscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'Your newsletter subscription is cancelled.',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    }
}

// Product Preloader
function giftsPreloader(limit = 4) {
    var output = '';
    for (var i = 0; i < limit; i++) {
        output += `
            <!-- Product Placeholder Card -->
            <div class="card placeholder-card bg-whitesmoke border-0 rounded-0 box-shadow-sm">
                <div class="img-wrapper-placeholder">
                    <div class="placeholder-label"></div>
                    <div class="placeholder-img"></div>
                </div>
                <hr class="grid-view-hr my-0 py-0">
                <div class="placeholder-card-content">
                    <div class="card-body placeholder-body m-0 p-0">
                        <div class="content-placeholder title-placeholder mt-1 ml-2"></div>
                        <div class="content-placeholder category-placeholder my-1 ml-2"></div>
                        <div class="d-flex align-items-center">
                            <div class="content-placeholder rating-placeholder ml-2"></div>
                            <div class="content-placeholder review-placeholder ml-2"></div>
                        </div>
                        <div class="content-placeholder description-placeholder mt-2 mb-1 mx-2"></div>
                        <div class="content-placeholder half-description-placeholder ml-2"></div>
                        <div class="d-flex align-items-center justify-content-between mt-2">
                            <div class="content-placeholder price-placeholder mr-2 ml-2"></div>
                            <div class="content-placeholder before-price-placeholder mr-2"></div>
                        </div>
                        <div class="text-center w-100 mx-0 px-0 mb-1">
                            <div class="btn-group btn-group-sm mt-0 pt-0 btn-group-placeholder pulse">
                                <button class="btn btn-sm btn-cart-placeholder rounded-left"></button>
                                <button class="btn btn-sm compare-btn-placeholder rounded-right"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.Product Placeholder Card -->
        `;
    }
    $('.products-shelf').html(output);
}

// Related gifts preloader
function relatedPreloader() {
    let output = '';
    for ($i = 0; $i < 6; $i++) {
        output += `
            <!-- Related Gifts Placeholder -->
            <div class="related-gift placeholder-card card bg-whitesmoke box-shadow-sm rounded-0 border-0 w-100">
                <div class="placeholder-relative-img"></div>
                <div class="gift-content mx-1">
                    <div class="placeholder-title content-placeholder"></div>
                    <div class="d-inline-block w-100 lh-100">
                        <div class="gift-count-placeholder content-placeholder"></div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between w-100">
                        <div class="gift-rating-placeholder content-placeholder"></div>
                        <div class="gift-rating-placeholder content-placeholder mr-2"></div>
                    </div>
                    <div class="price-range-placeholder mt-1 content-placeholder"></div>
                </div>
            </div>
            <!-- /.Related Gifts Placeholder -->
        `;
    }
    $('#gift-categories').html(output);
}

// Limit number of text characters
function limitArticleDesc(selector, maxLength) {
    $(selector).html((i, txt) => txt.length > maxLength ? txt.substr(0, maxLength) + '...<p class="text-left font-600 mt-2"><a href="">Read full article</a></p>' : txt);
};

limitProdDesc('.comparison-title', 17);

function limitProdDesc(selector, maxLength) {
    $(selector).html((i, txt) => txt.length > maxLength ? txt.substr(0, maxLength) + '...' : txt);
};

function userTheme() {
    if ($('body').hasClass('darkmode')) {
        // Change the theme to default
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        $('.theme-switch').attr('checked', false);
        localStorage.setItem('theme', 'default');
    } else {
        // Change to darkmode
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    }
}

// Toggling between the dark and light mode
function themeMode(obj) {
    var darkmode = obj.checked;
    if (darkmode) {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    } else {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'default');
        $('.theme-switch').attr('checked', false);
    }
}

// Fetch user's currency
function userCurrency() {
    // Determine user currency setting
    var currency = localStorage.getItem('currency');
    if (currency) {
        if (currency == 'usd') {
            $('.usd-currency').attr('checked', true);
            $('.zar-currency').attr('checked', false);
            $('.zwl-currency').attr('checked', false);
            $('.usd-price').removeClass('d-none');
            $('.zar-price').addClass('d-none');
            $('.zwl-price').addClass('d-none');
            $('#currency').val('usd');
            $('#min-price').attr('placeholder', 'US$Min');
            $('#max-price').attr('placeholder', 'US$Max');
        } else if (currency == 'zar') {
            $('.usd-currency').attr('checked', false);
            $('.zar-currency').attr('checked', true);
            $('.zwl-currency').attr('checked', false);
            $('.usd-price').addClass('d-none');
            $('.zar-price').removeClass('d-none');
            $('.zwl-price').addClass('d-none');
            $('#currency').val('zar');
            $('#min-price').attr('placeholder', 'ZARMin');
            $('#max-price').attr('placeholder', 'ZARMax');
        } else if (currency == 'zwl') {
            $('.usd-currency').attr('checked', false);
            $('.zar-currency').attr('checked', false);
            $('.zwl-currency').attr('checked', true);
            $('.usd-price').addClass('d-none');
            $('.zar-price').addClass('d-none');
            $('.zwl-price').removeClass('d-none');
            $('#currency').val('zwl');
            $('#min-price').attr('placeholder', 'ZW$Min');
            $('#max-price').attr('placeholder', 'ZW$Max');
        }
    } else {
        $('.usd-currency').attr('checked', true);
        $('.zar-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
}

// Toggle usd currency
function usdCurrency(obj) {
    var usd_currency = obj.checked;
    if (usd_currency === true) {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    } else {
        $('.zar-currency').attr('checked', 'checked');
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').addClass('d-none');
        $('.zar-price').removeClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'zar');
        $('#currency').val('zar');
        $('#min-price').attr('placeholder', 'ZARMin');
        $('#max-price').attr('placeholder', 'ZARMax');
    }
}

// Toggle zar currency
function zarCurrency(obj) {
    var zar_currency = obj.checked;
    if (zar_currency === true) {
        $('.zar-currency').attr('checked', 'checked');
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').addClass('d-none');
        $('.zar-price').removeClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'zar');
        $('#currency').val('zar');
        $('#min-price').attr('placeholder', 'ZARMin');
        $('#max-price').attr('placeholder', 'ZARMax');
    } else {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
}

// Toggle zar currency
function zwlCurrency(obj) {
    var zwl_currency = obj.checked;
    if (zwl_currency === true) {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', true);
        $('.usd-price').addClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').removeClass('d-none');
        localStorage.setItem('currency', 'zwl');
        $('#currency').val('zwl');
        $('#min-price').attr('placeholder', 'ZW$Min');
        $('#max-price').attr('placeholder', 'ZW$Max');
    } else {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
}

// Toggle usd currency zimswitch
function usDollar() {
    $('.zar-currency').attr('checked', false);
    $('.usd-currency').attr('checked', true);
    $('.zwl-currency').attr('checked', false);
    $('.usd-price').removeClass('d-none');
    $('.zar-price').addClass('d-none');
    $('.zwl-price').addClass('d-none');
    localStorage.setItem('currency', 'usd');
    $('#currency').val('usd');
    $('#min-price').attr('placeholder', 'US$Min');
    $('#max-price').attr('placeholder', 'US$Max');
}

// Toggle zar currency
function zaRand() {
    $('.zar-currency').attr('checked', 'checked');
    $('.usd-currency').attr('checked', false);
    $('.zwl-currency').attr('checked', false);
    $('.usd-price').addClass('d-none');
    $('.zar-price').removeClass('d-none');
    $('.zwl-price').addClass('d-none');
    localStorage.setItem('currency', 'zar');
    $('#currency').val('zar');
    $('#min-price').attr('placeholder', 'ZARMin');
    $('#max-price').attr('placeholder', 'ZARMax');
}

// Toggle zar currency
function zwBond() {
    $('.zar-currency').attr('checked', false);
    $('.usd-currency').attr('checked', false);
    $('.zwl-currency').attr('checked', true);
    $('.usd-price').addClass('d-none');
    $('.zar-price').addClass('d-none');
    $('.zwl-price').removeClass('d-none');
    localStorage.setItem('currency', 'zwl');
    $('#currency').val('zwl');
    $('#min-price').attr('placeholder', 'ZW$Min');
    $('#max-price').attr('placeholder', 'ZW$Max');
}

// Details page animations
function customizationAnime() {
    $('#accessory-animation-modal').modal('show');
    setTimeout(() => {
        $('#accessory-animation-modal').modal('hide');
    }, 3000);
}

//Click profile avatar placeholder to upload file
function triggerClick() {
    $('#profile-pic').on('click');
}

function displayImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('.prof-pic').attr('src', e.target.result);
        }
        reader.readAsDataURL(e.files[0]);
    }
}

//Click to change cover page
function changeCoverPic() {
    $('#cover-img').on('click');
}

function displayCoverImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('.cover-page').attr('src', e.target.result);
        }
        reader.readAsDataURL(e.files[0]);
    }
}

// Fetch user's details
function userInfo() {
    var action = 'user-info';
    $.ajax({
        url: '/user_info',
        method: 'post',
        data: {
            action: action,
            _token: _token
        },
        dataType: 'json',
        success: function(data) {
            $('#count-wishlist').html(data.count_wishlist);
            if (data.count_wishlist == 0) {
                $('#count-wishlist').text('');
            } else if (data.count_wishlist == 1) {
                $('#wishlist-text').html('You\'ve <span class="badge badge-primary">1</span> item in your Wishlist');
                $('.wishlist').attr('title', '1 item in your Wishlist');
            } else if (data.count_wishlist > 1) {
                $('.wishlist').attr('title', data.count_wishlist + ' items in your Wishlist');
                $('#wishlist-text').html('You\'ve <span class="badge badge-primary">' + data.count_wishlist + '</span> items in your Wishlist');
            }
            var birth_date = data.birth_date;
            var birthday = ("0" + birth_date).slice(-2);
            var birth_month = `${data.birth_month}`;
            var birth_year = data.birth_year;
            $('.birthday-date').val(birthday);
            $('.birth-month').val(birth_month);
            $('.birth-year').val(birth_year);
        }
    });
}

// Fetch users wishlist data and display
function myWishlist() {
    var action = 'my-wishlist';
    $.ajax({
        url: '/wishlist/display',
        method: 'post',
        data: {
            action: action,
            _token: _token
        },
        dataType: 'json',
        success: function(data) {
            $('#saved-gifts').html(data.saved_gifts);
            $('#wishlist').html(data.wishlist);
        }
    });
}