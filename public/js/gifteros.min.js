// Checkout cart details custom-type-radio
var usd_delivery = zar_delivery = zwl_delivery = 0;
var usd_coupon = zar_coupon = zwl_coupon = 0;
var sale_usd_price = sale_zar_price = sale_zwl_price = 0;
var customizing_usd_cost = customizing_zar_cost = customizing_zwl_cost = 0;
var usd_subtotal = zar_subtotal = zwl_subtotal = 0;
var gift_id, post_id, user_id, gift_name, filter, customization_type;
var gift_quantity = 1;

var error = `
    <div class="row justify-content-center my-5">
        <div class="d-block text-center">
            <i class="material-icons fa-5x text-muted">error_outline</i>
            <h6 class="font-600 mt-2">
                Oops! Something seems to have gone wrong on our part. Try refreshing the page.
            </h6>
            <button class="btn btn-primary btn-sm d-flex align-items-center justify-content-center px-3 reload-page">
                <i class="material-icons mr-1">refresh</i>
                Refresh
            </button>
        </div>
    </div>
`;

// The cart array to hold all gifts in localStorage
var cart = sale_end_time = [];

var start = 0;
var limit = 8;
var status = 'inactive';

// Date and time functions
var today = new Date();
var user_time = ("0" + today.getHours()).slice(-2);
var date = ("0" + today.getDate()).slice(-2);
var mnth = ("0" + today.getMonth()).slice(-2);
var year = today.getFullYear();
var day = new Array();
day[0] = 'Sunday';
day[1] = 'Monday';
day[2] = 'Tuesday';
day[3] = 'Wednesday';
day[4] = 'Thursday';
day[5] = 'Friday';
day[6] = 'Saturday';

var d = day[today.getDay()];

var month = new Array();
month[0] = 'January';
month[1] = 'February';
month[2] = 'March';
month[3] = 'April';
month[4] = 'May';
month[5] = 'June';
month[6] = 'July';
month[7] = 'August';
month[8] = 'September';
month[9] = 'October';
month[10] = 'November';
month[11] = 'December';

$(function() {
    // Pass the csrf token to all ajax calls
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });

    // Reload current page
    $(document).on('click', '.reload-page', function() {
        reloadPage();
    });

    // Clear the comparison session
    clearComparisons();

    // Fetch shopping cart details
    shoppingCart();

    //Alert Tone
    function alert_tone() {
        var tone = '<audio autoplay="true"><source src="../tones/alert.wav"></audio>';
        $('body').append(tone);
    }

    // Initialize all toast notifications
    setTimeout(() => {
        $('#shopping-alerts').toast('show');
    }, 1000);

    function settingsAlert() {
        var alert = localStorage.getItem('settings-alert');
        if (alert) {
            if (alert !== 'seen') {
                setTimeout(() => {
                    $('#settings-alert').toast('show');
                }, 3000);
            } else {
                $('#settings-alert').toast('hide');
            }
        } else {
            $('#settings-alert').toast('show');
        }
    }

    $('#dispose-toast').on('click', function() {
        $('#settings-alert').toast('dispose');
        localStorage.setItem('settings-alert', 'seen');
    });

    // Toggle mobile search form
    $('.toggle-search-form').on('click', function() {
        if ($('.filter-search-form').hasClass('d-none')) {
            $('.search-icon').html('close');
        } else {
            $('.search-icon').html('search');
        }
        $('.filtered-products').toggleClass('clearfix');
        $('.occasions-container').toggleClass('clearfix');
        $('.mobile-sub-nav').toggleClass('d-none');
        $('.filter-search-form').toggleClass('d-none');
    });

    // Toggle mobile filter settings
    $('.toggle-filters').on('click', function() {
        $('.gift-filters').toggleClass('show');
    });

    $('.filter-btn').on('click', function(e) {
        e.preventDefault();
        $('.filter-btn').not(this).removeClass('active');
        $(this).addClass('active');
        $('.gift-filters').toggleClass('show');
    });

    // Click to toggle floating-action-buttons
    $(document).on('click', '.toggle-actions', function() {
        $('.action-btn').toggleClass('show');
    });

    // Force numeric values on text inputs
    $('body').on('keyup', '.number-input', forceNumeric);

    // Change profile picture
    $(document).on('change', '#profile-pic', function(e) {
        e.stopPropagation();
        var property = this.files[0];
        var profile_pic = property.name;
        var ext = profile_pic.split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'jfif', 'png', 'jpg', 'jpeg']) == -1) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file type not allowed!',
                messageColor: '#000',
                position: 'center'
            });
        }
        var img_size = property.size;
        if (img_size > 5000000) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file too large!',
                messageColor: '#000',
                position: 'center'
            });
        } else {
            var form_data = new FormData();
            form_data.append('profile-pic', property);
            $.ajax({
                url: '/profile_pic',
                method: 'post',
                data: form_data,
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function() {
                    $('.line').css('display', 'block');
                },
                success: function(response) {
                    if (response) {
                        $('.line').css('display', 'none');
                        iziToast.show({
                            theme: 'dark',
                            timeout: 2000,
                            closeOnClick: true,
                            overlay: false,
                            close: false,
                            backgroundColor: 'var(--success)',
                            progressBar: false,
                            icon: 'ion-checkmark text-light',
                            message: response.message,
                            messageColor: '#fff',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Change cover page image
    $(document).on('change', '#cover-img', function(e) {
        e.stopPropagation();
        var property = this.files[0];
        var cover_page = property.name;
        var ext = cover_page.split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'jfif', 'png', 'jpg', 'jpeg']) == -1) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file type not allowed!',
                messageColor: '#000',
                position: 'center'
            });
        }
        var img_size = property.size;
        if (img_size > 5000000) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                overlay: false,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Oops! Image file too large!',
                messageColor: '#000',
                position: 'center'
            });
        } else {
            var form_data = new FormData();
            form_data.append('cover-img', property);
            $.ajax({
                url: '/cover_page',
                method: 'post',
                data: form_data,
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function() {
                    $('.line').css('display', 'block');
                },
                success: function(response) {
                    if (response) {
                        $('.line').css('display', 'none');
                        iziToast.show({
                            theme: 'dark',
                            timeout: 2000,
                            closeOnClick: true,
                            overlay: false,
                            close: false,
                            backgroundColor: 'var(--success)',
                            progressBar: false,
                            icon: 'ion-checkmark text-light',
                            message: response.message,
                            messageColor: '#fff',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Update personal details
    $('#user-info').on('submit', function(e) {
        e.preventDefault();
        var action = 'update-profile';
        var address = $('#address').val();
        var birth_date = $('.birthday-date').val();
        var birth_month = $('.birth-month').val();
        var birth_year = $('.birth-year').val();
        var birthday = `${birth_year}/${birth_month}/${birth_date}`;
        var city = $('#city').val();
        var email = $('#email').val();
        var name = $('#name').val();
        var mobile_phone = $('#mobile-phone').val();
        $.ajax({
            url: '/account/update',
            method: 'post',
            data: {
                action: action,
                address: address,
                bithday: birthday,
                city: city,
                email: email,
                name: name,
                mobile_phone: mobile_phone
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'updated') {
                    $('#user-info').removeClass('was-validated');
                    userProfile();
                    iziToast.show({
                        theme: 'dark',
                        timeout: 2000,
                        closeOnClick: true,
                        backgroundColor: 'var(--success)',
                        progressBar: false,
                        overlay: false,
                        icon: 'ion-checkmark text-light',
                        message: 'Profile successfully updated.',
                        messageColor: '#fff',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Oops! Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    });

    // Change account password
    $('#change-password').on('submit', function(e) {
        e.preventDefault();
        var new_password = $('#new-password').val();
        var confirm_password = $('#confirm-password').val();
        var errors = false;

        if (new_password == '' || confirm_password == '') {
            $('#new-password-error').text('New password required!');
            $('#confirm-error').text('Field cannot be blank!');
            $('#new-password').addClass('is-invalid');
            $('#confirm-password').addClass('is-invalid');
            $('#new-password-error').show();
            $('#confirm-error').show();
            $('#change-password-btn').attr('type', 'button');
            errors = true;
        }

        if (new_password !== confirm_password) {
            $('#new-password-error').text('Passwords do not match!');
            $('#confirm-error').text('Passwords do not match!');
            $('#new-password').removeClass('is-valid');
            $('#confirm-password').removeClass('is-valid');
            $('#new-password').addClass('is-invalid');
            $('#confirm-password').addClass('is-invalid');
            $('#new-password-error').show();
            $('#confirm-error').show();
            errors = true;
        } else {
            $('#new-password-error').hide();
            $('#confirm-error').hide();
            $('#new-password').removeClass('is-invalid');
            $('#confirm-password').removeClass('is-invalid');
        }

        if (errors == false) {
            var action = 'change-password';
            $.ajax({
                url: '/account/change_password',
                method: 'post',
                data: {
                    action: action,
                    new_password: new_password
                },
                success: function(data) {
                    if (data.message == 'success') {
                        $('#change-password').removeClass('was-validated');
                        $('#change-password').removeClass('was-validated');
                        $('#change-password')[0].reset();
                        iziToast.show({
                            theme: 'dark',
                            timeout: 5000,
                            overlay: false,
                            icon: 'ion ion-checkmark text-light',
                            backgroundColor: 'var(--success)',
                            message: 'Password successfully changed!',
                            position: 'center'
                        });
                    } else {
                        iziToast.warning({
                            theme: 'dark',
                            timeout: 5000,
                            closeOnClick: true,
                            close: false,
                            progressBar: false,
                            backgroundColor: 'var(--warning)',
                            icon: 'ion-android-alert text-dark',
                            message: 'Oops! Something went wrong!',
                            messageColor: '#000',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    // Joining the mailing list
    $('#subscription-form').on('submit', function(e) {
        e.preventDefault();
        var form_data = $(this).serialize();
        $.ajax({
            url: '/subscribe',
            method: 'post',
            data: form_data,
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    $('#subscription-form').removeClass('was-validated');
                    $('#mailing-list').modal('hide');
                    localStorage.setItem('newsletter', 'subscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'You\'ve successfully subscribed to our newsletter!',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    });

    // Gift search suggestions
    $(document).on('keyup', '#search', function() {
        let search = $(this).val();
        let val = search.length;
        if (val > 0) {
            $(this).addClass('expanded');
            $('.search-list').removeClass('d-none');
            $.ajax({
                url: '/search',
                method: 'get',
                data: {
                    search: search
                },
                dataType: 'json',
                success: function(data) {
                    $('.search-list').html(data.results);
                    userCurrency();
                }
            });
        } else {
            $(this).removeClass('expanded');
            $('.line').css('display', 'none');
            $('.search-list').addClass('d-none');
        }
    });

    // Calculate delivery (shipping) costs
    $(document).on('change', '#customer-suburb', function() {
        var delivery_charge = $(this).val();
        var suburb = $('#customer-suburb option:selected').data('suburb');
        // Update the cart for a new total
        if (delivery_charge !== 0) {
            $('#suburb').val(suburb);
            var usd_delivery_cost = parseFloat($(this).val());
            var action = 'shipping-costs';
            $.ajax({
                url: '/shipping-costs',
                method: 'post',
                data: {
                    action: action,
                    usd_delivery_cost: usd_delivery_cost
                },
                success: function() {
                    shoppingCart();
                }
            });
        } else {
            $('#customer-suburb').toggleClass('is-invalid');
        }
    });

    // Checking if user has accepted the cookie policy or not
    let cookie_policy = localStorage.getItem('cookie-policy');
    if (cookie_policy !== '' && cookie_policy == 'agreed') {
        $('.policy-banner').hide();
    } else {
        $('.policy-banner').show();
    }

    $(document).on('click', '.cookie-policy-btn', function(e) {
        e.preventDefault();
        localStorage.setItem('cookie-policy', 'agreed');
        $('.policy-banner').addClass('animated animate-slow slideOutRight');
        $('.policy-banner').show();
    });

    /*** App's Methods & Functions ***/
    setTimeout(() => {
        userCurrency();
    }, 500);

    // Create a storage class to handle all localStorage functions
    class Storage {
        static userData() {
            let data = localStorage.getItem('user-data');
            let user_data;
            if (data === null) {
                user_data = [];
            } else {
                user_data = JSON.parse(localStorage.getItem('user-data'));
            }
            return user_data;
        }
        static getTheme() {
                let theme = localStorage.getItem('theme');
                let theme_setting;
                if (theme) {
                    if (theme === 'darkmode') {
                        theme_setting = 'darkmode';
                    } else {
                        theme_setting = 'default';
                    }
                } else {
                    theme_setting = 'default';
                }
                return theme_setting;
            }
            // Get all viewed products
        static getViewedItems() {
            let viewed_products;
            if (localStorage.getItem('viewed-products') === null) {
                viewed_products = [];
            } else {
                viewed_products = JSON.parse(localStorage.getItem('viewed-products'));
            }
            return viewed_products;
        }
    }

    // Fetch user data from the localStorage
    userPreferences();

    function userPreferences() {
        settingsAlert();

        // Get user's theme mode
        appTheme();

        // Get user's name sorting order
        nameOrdering();

        // Get user's price sorting order
        priceOrdering();

        // Fetch user's products view option
        viewOption();

        // Determine if user is registered or not
        var user_data = Storage.userData();
        if (user_data.length !== 0) {
            $('.visitor').toggleClass('d-none');
        } else {
            $('.registered-user').toggleClass('d-none');
        }

        // Get user newsletter subscription
        var newsletter = localStorage.getItem('newsletter');
        if (newsletter) {
            if (newsletter == 'subscribed') {
                $('#newsletter').attr('checked', true);
            } else {
                $('#newsletter').attr('checked', false);
            }
        } else {
            $('#newsletter').attr('checked', false);
        }
    }

    // Check if user has already been given a newbie coupon
    newbieCoupon();

    function newbieCoupon() {
        var newbie_coupon = localStorage.getItem('newbie-coupon');
        if (newbie_coupon) {
            $('#newbie-modal').modal('hide');
        } else {
            $('#newbie-modal').modal('show');
        }
    }

    // Fetch user's app theme
    function appTheme() {
        let theme = Storage.getTheme();
        if (theme === 'darkmode') {
            $('body').toggleClass('darkmode');
            $('.main-sidebar').toggleClass('bg-meshgrid');
            $('.settings-bar').toggleClass('bg-meshgrid');
            $('.theme-switch').attr('checked', true);
        } else {
            $('.theme-switch').attr('checked', false);
        }
    }

    $('#toggle-mailing-list').on('click', function() {
        var newsletter = localStorage.getItem('newsletter');
        if (newsletter) {
            if (newsletter == 'subscribed') {
                $('#newsletter').attr('checked', true);
                $('#mailing-list').modal('hide');
                $('#subscribed-modal').modal('show');
            } else {
                $('#newsletter').attr('checked', false);
                $('#mailing-list').modal('show');
                $('#subscribed-modal').modal('hide');
            }
        } else {
            $('#newsletter').attr('checked', false);
            $('#mailing-list').modal('show');
            $('#subscribed-modal').modal('hide');
        }
    });

    // Hide the gradient progress bar when page is loaded
    $('.line').hide();

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    // App Rating
    $('.toggle-ratingbox').on('click', function(e) {
        e.preventDefault();
        $('.app-rating-box').toggleClass('show');
        $('.main-sidebar').removeClass('show');
        $('.app-backdrop').addClass('d-none');
    });

    $('.performance-rating').on('click', function() {
        $('.main-sidebar').removeClass('show');
        $('.performance-rating').not(this).removeClass('active');
        $(this).addClass('active');
        var p_rating = $(this).data('value');
        $('#p-rating').val(p_rating);
    });

    $('.response-rating').on('click', function() {
        $('.response-rating').not(this).removeClass('active');
        $(this).addClass('active');
        var r_rating = $(this).data('value');
        $('#r-rating').val(r_rating);
    });

    $(document).on('submit', '#app-rating', function(e) {
        e.preventDefault();
        var p_rating = $('#p-rating').val();
        var r_rating = $('#r-rating').val();
        var comment = $('#app-review').val();
        var action = 'app-rating';
        var errors = false;

        if (p_rating === '') {
            errors = true;
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Performance rating required!',
                messageColor: '#000',
                position: 'center'
            });
        } else if (r_rating === '') {
            errors = true;
            iziToast.warning({
                theme: 'dark',
                timeout: 5000,
                closeOnClick: true,
                close: false,
                progressBar: false,
                backgroundColor: 'var(--warning)',
                icon: 'ion-android-alert text-dark',
                message: 'Response rating required!',
                messageColor: '#000',
                position: 'center'
            });
        } else if (comment === '') {
            errors = true;
            $('#app-review').addClass('is-invalid');
            $('#app-comment-error').show();
        }

        if (errors == false) {
            $.ajax({
                url: '/app_rating',
                method: 'post',
                data: {
                    p_rating: p_rating,
                    r_rating: r_rating,
                    comment: comment,
                    action: action
                },
                dataType: 'json',
                success: function(data) {
                    if (data.message == 'success') {
                        $('#app-rating')[0].reset();
                        $('#app-rating').removeClass('was-validated');
                        $('.app-rating-box').removeClass('show');
                        $('.main-sidebar').removeClass('show');
                        $('.app-backdrop').addClass('d-none');
                        $('#specific-comments').val('');
                        $('.performance-rating').removeClass('active');
                        $('.response-rating').removeClass('active');
                        $('#success-modal').modal('show');
                        $('#success-message').text('Thank you for your feedback! We hope to improve.');
                    } else {
                        iziToast.warning({
                            theme: 'dark',
                            timeout: 5000,
                            closeOnClick: true,
                            close: false,
                            progressBar: false,
                            backgroundColor: 'var(--warning)',
                            icon: 'ion-android-alert text-dark',
                            message: 'Hmmm...Something went wrong!',
                            messageColor: '#000',
                            position: 'center'
                        });
                    }
                }
            });
        }
    });

    //Get the button
    $(window).on('scroll', function() {
        if ($(document).height() >= $(window).height()) {
            $('#scroll-top').css('display', 'block');
        } else {
            $('#scroll-top').css('display', 'none');
        }
    });

    // Input masks
    $('[data-mask]').inputmask();

    // Enable popovers and tooltips
    $('[data-toggle="popover"]').popover();
    $('[data-toggle="tooltip"]').tooltip();

    // Toggle the active class when icon-links are clicked
    $('.icon-link').on('click', function() {
        $('.icon-link').not(this).removeClass('active');
        $(this).addClass('active');
    });

    // Toggle the mega-menu
    $('.mega-item').on('mouseenter', function(e) {
        $('.mega-menu').addClass('show');
    });

    $('.mega-menu').on('mouseleave', function(e) {
        $('.mega-menu').removeClass('show');
    });

    // Stop propagation
    $('.user-menu').on('click', function(e) {
        e.stopPropagation();
    });

    // Toggle Reviews
    $('.toggle-reviews').on('click', function(e) {
        e.preventDefault();
        $('#product-reviews').slideToggle('slow');
        $('.view-reviews').toggleClass('d-none');
    });

    // Toggling view-options
    $('.view-option').on('click', function() {
        var view_option = $(this).data('view');

        if (view_option === 'grid-view') {
            if ($('.products-shelf').hasClass('grid-view') && $('.gifts-preloader').hasClass('grid-view')) {
                $('.products-shelf').removeClass('list-view');
                $('.gifts-preloader').removeClass('list-view');
            } else {
                $('.products-shelf').removeClass('list-view');
                $('.gifts-preloader').removeClass('list-view');
                $('.products-shelf').addClass('grid-view');
                $('.gifts-preloader').addClass('grid-view');
            }

            $('.list-icon').removeClass('active');
            $('.grid-icon').addClass('active');

        } else if (view_option === 'list-view') {
            if ($('.products-shelf').hasClass('list-view') && $('.gifts-preloader').hasClass('list-view')) {
                $('.products-shelf').removeClass('grid-view');
                $('.gifts-preloader').removeClass('grid-view');
            } else {
                $('.products-shelf').removeClass('grid-view');
                $('.gifts-preloader').removeClass('grid-view');
                $('.products-shelf').addClass('list-view');
                $('.gifts-preloader').addClass('list-view');
            }
            $('.grid-icon').removeClass('active');
            $('.list-icon').addClass('active');
        }

        // Save the user's option in local storage
        localStorage.setItem('view-option', view_option);
    });

    // Toggle sidebar
    $('.menu-btn').on('click', function() {
        $('.main-sidebar').toggleClass('show').focus();
        $('.app-backdrop').toggleClass('d-none');
    });

    $('.main-sidebar').on('focusout', function() {
        $('.main-sidebar').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Toggle settings sidebar
    $('.toggle-settings').on('click', function(e) {
        e.stopPropagation();
        $('.settings-bar').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Comparing Products
    $(document).on('click', '.compare-btn', function() {
        // Get product details
        var gift_id = $(this).data('id');
        var gift_name = $(this).data('name');
        var gift_img = $('#image' + gift_id).val();
        var usd_price = $('#usd-price' + gift_id).val();
        var zar_price = $('#zar-price' + gift_id).val();
        var zwl_price = $('#zwl-price' + gift_id).val();
        var gift_category = $('#category-name' + gift_id).val();
        var gift_quantity = $('#quantity' + gift_id).val();
        var gift_units = $('#product-units' + gift_id).val();
        var gift_description = $('#description' + gift_id).val();
        var action = 'add-comparison';

        if ($('#compare-btn' + gift_id).hasClass('active')) {
            $('#compare-btn' + gift_id).removeClass('active');
            $('#compare-btn' + gift_id).html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
            var product = document.querySelector('#product-pane' + gift_id);
            // Replace the product's pane with the placeholder plane
            const placeholder_pane = document.createElement('div');
            placeholder_pane.classList = 'product-pane empty box-shadow-sm';
            placeholder_pane.innerHTML = `
                <div class="empty-content text-center p-2">
                    <p class="text-sm mb-0 pb-0 text-white">
                        Add product to compare
                    </p>
                    <div class="row justify-content-center">
                        <div class="d-flex align-items-center text-white rounded-0 mt-1">
                            <i class="material-icons mr-1">compare_arrows</i> Compare
                        </div>
                    </div>
                </div>
            `;
            let gift_pane = document.querySelector('.compare-products');
            gift_pane.replaceChild(placeholder_pane, product);

            // remove the product item form the comparison session
            var action = 'remove-comparison';
            $.ajax({
                url: '/remove_comparison',
                method: 'post',
                data: {
                    action: action,
                    gift_id: gift_id
                },
                success: function() {

                }
            });
        } else {
            $('#compare-btn' + gift_id).addClass('active');
            $('#compare-btn' + gift_id).html('<i class="material-icons mr-1">done</i> Selected');
            // Create compare product
            let gift_pane = document.querySelector('.compare-products');
            let product = document.createElement('div');
            product.classList = 'product-pane filled box-shadow-sm';
            product.id = 'product-pane' + gift_id;
            product.innerHTML = `
                <div class="media p-2">
                    <span role="button" class="material-icons text-danger remove-comparison" id="${gift_id}" title="Remove product">cancel</span>
                    <img src="../storage/gifts/${gift_img}" height="80" width="80" alt="${gift_name}">
                    <div class="media-body lh-100 ml-2">
                        <p class="text-sm text-capitalize comparison-title font-600 text-faded my-0 py-0">
                            ${gift_name}
                        </p>
                        <p class="text-sm text-capitalize text-primary my-0 py-0">
                            ${gift_category}
                        </p>
                        <p class="font-600 text-blue usd-price mt-4">US$${usd_price}</p>
                        <p class="font-600 text-blue zar-price d-none mt-4">R${zar_price}</p>
                        <p class="font-600 text-blue zwl-price d-none mt-4">ZW$${zwl_price}</p>
                    </div>
                </div>
            `;
            let placeholder_pane = document.querySelector('.product-pane.empty');
            gift_pane.replaceChild(product, placeholder_pane);

            // Check if comparison-panels are above 1
            comparisons();
            $.ajax({
                url: '/add_comparison',
                method: 'post',
                data: {
                    gift_id: gift_id,
                    gift_name: gift_name,
                    gift_img: gift_img,
                    usd_price: usd_price,
                    zar_price: zar_price,
                    zwl_price: zwl_price,
                    gift_category: gift_category,
                    gift_description: gift_description,
                    gift_quantity: gift_quantity,
                    gift_units: gift_units,
                    action: action
                },
                success: function() {}
            });
        }
    });

    // Close the comparisons panel when close icon is clicked
    $(document).on('click', '#close-panel', function() {
        clearComparisons();
    });

    // Remove product comparison
    $(document).on('click', '.remove-comparison', function() {
        var gift_id = $(this).attr('id');
        removeComparison(gift_id);
    });

    // Submit products to compare
    $(document).on('submit', '#compare-form', function(e) {
        e.preventDefault();
        window.location.href = '/compare_page';
    });

    // Expire the compare gifts session
    $('.expire-session').on('click', function() {
        clearComparisons();
        setTimeout(() => {
            window.location.href = '/';
        }, 500);
    });

    // Selecting a custom type
    $('.custom-type').on('click', function() {
        $('.custom-type').not(this).removeClass('active');
        $(this).addClass('active');

        // Get the custom type
        var custom_type = $(this).attr('id');
        if (custom_type == 'custom-image-option') {
            $('#add-custom-image').removeClass('d-none');
            $('.custom-text-screen').addClass('d-none');
            $('#custom-text-form').hide();
        } else if (custom_type == 'custom-text-option') {
            $('#add-custom-image').addClass('d-none');
            $('.custom-text-screen').removeClass('d-none');
            $('#custom-text-form').slideToggle('slow');
            $('#toggle-custom-settings').addClass('d-none');
        } else {
            $('#add-custom-image').addClass('d-none');
            $('.custom-text-screen').addClass('d-none');
            $('#custom-text-form').hide();
            $('#toggle-custom-settings').addClass('d-none');
        }
    });

    // Toggle custom-types
    $(document).on('click', '#toggle-custom-text', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $('#custom-image-option').removeClass('active');
        $('#custom-text-option').addClass('active');
        $('#add-custom-image').addClass('d-none');
        $('.custom-text-screen').removeClass('d-none');
        $('#custom-text-form').slideToggle('slow');
        $('#toggle-custom-settings').addClass('d-none');
    });

    // Selecting a custom color
    $('.custom-color').on('click', function() {
        $('.custom-color').not(this).removeClass('active');
        $(this).toggleClass('active');
    });

    // Selecting a custom size
    $('.gift-sizes').on('click', function() {
        $('.gift-sizes').not(this).removeClass('active');
        $(this).addClass('active');
    });

    // Toggle the customization modal
    $(document).on('click', '.toggle-customization', function(e) {
        e.preventDefault();
        gift_id = $(this).data('id');
        category_id = $('#category-id' + gift_id).val();
        gift_name = $('#name' + gift_id).val();
        gift_image = $('#image' + gift_id).val();
        usd_price = parseFloat($('#usd-price' + gift_id).val());
        zar_price = parseFloat($('#zar-price' + gift_id).val());
        zwl_price = parseFloat($('#zwl-price' + gift_id).val());
        // Show customization modal
        resetFileUpload();
        $('#customizing-modal').modal('show');

        // Only show gift size options to clothing gifts
        if (category_id == 17) {
            $('#clothing-sizes').removeClass('d-none');
        }

        $('#custom-text').on('keyup', function() {
            var custom_text = $(this).val();
            $('.custom-text-screen').html(custom_text);
            if (custom_text.length > 0) {
                $('#save-changes-btn').removeAttr('disabled');
            } else {
                $('#save-changes-btn').attr('disabled', true);
            }
        });

        $('#custom-gift-id').val(gift_id);
        $('#custom-gift-name').text(gift_name);
        $('#gift-usd-price').text(usd_price);
        $('#gift-zar-price').text(zar_price);
        $('#gift-zwl-price').text(zwl_price);

        // Make the clicked gift's image be the background
        $('#original-image').attr('src', `../storage/gifts/${gift_image}`);
        $('#user-custom-file').attr('src', `../storage/gifts/${gift_image}`);

        // Show sign in first modal if user is not signed in
        $(document).on('click', '#customize-signin-btn', function(e) {
            e.preventDefault();
            e.stopPropagation();
            window.location.href = 'index.php?redirect=details.php?id=' + gift_id;
        });

        // Show sign in first modal if user is not signed in
        $(document).on('click', '#customize-signup-btn', function(e) {
            e.preventDefault();
            e.stopPropagation();
            window.location.href = 'signup.php?redirect=details.php?id=' + gift_id;
        });

        $('.user-custom-img').attr('src', '../storage/gifts/' + gift_image);
        $('#original-image').attr('src', '../storage/gifts/' + gift_image);

        // Show that the gift is customized
        $('#gift-custom-img' + gift_id).attr('src', '../storage/gifts/' + gift_image);
    });

    /*** Cart Functions ***/
    // Add to Cart Functionality
    $(document).on('click', '.add-to-cart-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        gift_id = $(this).data('id');
        category_id = $('#category-id' + gift_id).val();
        category = $('#label' + gift_id).val();
        gift_name = $('#name' + gift_id).val();
        gift_image = $('#image' + gift_id).val();
        usd_price = parseFloat($('#usd-price' + gift_id).val());
        zar_price = parseFloat($('#zar-price' + gift_id).val());
        zwl_price = parseFloat($('#zwl-price' + gift_id).val());
        var sale_end_time = $('#end-time' + gift_id).val();
        var gift_quantity = $('#quantity' + gift_id).val();
        var gift_units = $('#product-units' + gift_id).val();
        var category_name = $('#category-name' + gift_id).val();

        // Don't toggle the customizing modal if gift already in cart
        $('#customizing-modal').modal('hide');
        $('.gift-cart-options').not(this).addClass('d-none');
        $('#cart-options' + gift_id).removeClass('d-none');
        addToCart(gift_id, gift_name, gift_image, usd_price, zar_price, zwl_price,
            sale_end_time, gift_quantity, gift_units, category_name);
        iziToast.show({
            animateInside: true,
            theme: 'dark',
            timeout: 3000,
            closeOnClick: true,
            overlay: false,
            close: false,
            backgroundColor: 'var(--success)',
            progressBar: false,
            icon: 'ion-checkmark text-light',
            image: '../storage/gifts/' + gift_image,
            imageWidth: 60,
            message: 'Gift item added into your gift box',
            messageColor: '#fff',
            position: 'topCenter'
        });
    });

    // Increase gift items quantity
    $(document).on('click', '.increase-qty', function(e) {
        e.preventDefault();
        e.stopPropagation();
        gift_id = $(this).data('id');
        category_id = $('#category-id' + gift_id).val();
        category = $('#label' + gift_id).val();
        gift_name = $('#name' + gift_id).val();
        gift_image = $('#image' + gift_id).val();
        usd_price = parseFloat($('#usd-price' + gift_id).val());
        zar_price = parseFloat($('#zar-price' + gift_id).val());
        zwl_price = parseFloat($('#zwl-price' + gift_id).val());
        var sale_end_time = $('#end-time' + gift_id).val();
        var gift_quantity = $('#quantity' + gift_id).val();
        var gift_units = $('#product-units' + gift_id).val();
        var category_name = $('#category-name' + gift_id).val();

        // Don't toggle the customizing modal if gift already in cart
        $('#customizing-modal').modal('hide');
        $('.gift-cart-options').not(this).addClass('d-none');
        $('#cart-options' + gift_id).removeClass('d-none');

        addToCart(gift_id, gift_name, gift_image, usd_price, zar_price, zwl_price,
            sale_end_time, gift_quantity, gift_units, category_name);
    });

    // Decrease gift item's quantity
    $(document).on('click', '.subtract-product', function(e) {
        e.preventDefault();
        e.stopPropagation();
        gift_id = $(this).data('id');
        subtractFromCart(gift_id);
    });

    // Remove a gift item from the cart
    $(document).on('click', '.remove-item', function(e) {
        e.preventDefault();
        e.stopPropagation();
        gift_id = $(this).data('id');
        removeItem(gift_id);
    });
    /*** /.Cart Functions ***/

    // Toggle the wishlist modal if user is not signed in
    $(document).on('click', '.guest-wishes', function() {
        var gift_id = $(this).attr('id');
        var gift_name = $(this).data('name');
        console.log(gift_id, gift_name);
        $('#wishlist-modal').modal('show');
        $('#visitor-wish-item').html(gift_name);
    });

    // View notifications
    $(document).on('click', '.notifications', function() {
        $('.notifications-counter').html('');
        notifications('seen');
    });

    /*** Details page functions and methods ***/

    // Toggling the yellow glow on mous-enter on an accessory
    $(document).on('mouseenter', '.greeting-card-img', function() {
        $('.greeting-card-img').not(this).removeClass('card-glow');
        $(this).addClass('card-glow');
    });

    $(document).on('mouseleave', '.greeting-card-img', function() {
        $('.greeting-card-img').not(this).removeClass('card-glow');
        $(this).removeClass('card-glow');
    });

    // Hide the rating success modal
    $(document).on('click', '#dismiss-success-modal', function() {
        window.location.reload();
        $('#success-modal').modal('hide');
    });

    //initiate the plugin and pass the id of the div containing gallery images
    $('#product-img').elevateZoom({
        gallery: 'gallery',
        cursor: 'pointer',
        galleryActiveClass: 'active',
        imageCrossfade: true,
        tint: true,
        tintColour: '#006effaf',
        tintOpacity: 0.5
    });

    //pass the images to Fancybox
    $("#product-img").bind("click", function(e) {
        var ez = $('#product-img').data('elevateZoom');
        $.fancybox(ez.getGalleryList());
        return false;
    });

    // Show review modal
    $('#show-write-review').on('click', function() {
        $('#write-review').modal('show');
    });

    // User gift_rating rating
    $("#user-rating").rateYo({
        onSet: function(rating, rateYoInstance) {
            $(this).next().text('Rating of ' + rating);
            $('#star-rating').val(rating);
        },
        normalFill: "#A0A0A0",
        maxValue: 5,
        starWidth: "20px",
        spacing: "10px"
    });

    /*** Checking Out ***/

    // Select recipient and populate the checkout form
    $(document).on('click', '.custom-type-label', function() {
        var recipient_id = $(this).data('id');
        var recipient_name = $(this).data('name');
        var recipient_email = $(this).data('email');
        var recipient_address = $(this).data('address');
        if ($('#checkbox-id' + recipient_id).hasClass('active')) {
            $('#checkbox-id' + recipient_id).removeClass('active');
            $('#fullname').val('');
            $('#mobile-number').val('');
            $('#customer-email').val('');
            $('#customer-address').val('');
        } else {
            $('#checkbox-id' + recipient_id).addClass('active');
            $('#fullname').val(recipient_name);
            $('#mobile-number').val(recipient_id);
            $('#customer-email').val(recipient_email);
            $('#customer-address').val(recipient_address);
        }
    });

    $(document).on('click', '.custom-type-radio', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $('.custom-type-radio').not(this).removeClass('active');
        $(this).toggleClass('active');
        var recipient_cell = $(this).data('cell');
        var recipient_name = $(this).data('name');
        var recipient_email = $(this).data('email');
        var recipient_address = $(this).data('address');
        if ($(this).hasClass('active')) {
            $(this).removeClass('active');
            $('#fullname').val('');
            $('#mobile-number').val('');
            $('#customer-email').val('');
            $('#customer-address').val('');
        } else {
            $(this).addClass('active');
            $('#fullname').val(recipient_name);
            $('#mobile-number').val(recipient_cell);
            $('#customer-email').val(recipient_email);
            $('#customer-address').val(recipient_address);
        }
    });

    // Delivery date functions
    const now = new Date().getDate();
    const minDate = new Date(new Date().setDate(now - 1));
    const maxDate = new Date(new Date().setFullYear(year - 15, mnth, date));
    date_placeholder = 'Sat, Jul 20';
    $('#delivery-date').attr('placeholder', date_placeholder);
    $('.datepicker').datepicker({
        showOtherMonths: true,
        modal: true,
        header: true,
        footer: true,
        format: 'ddd, mmm dd',
        minDate: minDate
    });

    // Submit checkout form
    $('#checkout-form').on('submit', function(e) {
        e.preventDefault();
        var form_data = $(this).serialize();
        $.ajax({
            url: '/stripe',
            method: 'post',
            data: form_data,
            beforeSend: function() {
                $('#processing-modal').modal('show');
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    $('#processing-modal').modal('hide');
                    $('#checkout-form')[0].reset();
                    window.location.href = data.url;
                }
            }
        });
    });

    /*** /.Checking Out ***/

    // Dismiss success modal
    $('#dismiss-success-modal').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $('#success-modal').modal('hide');
    });

    // New user's coupon code
    $('#newbie-coupon').on('click', function() {
        var action = 'newbie-coupon';
        $.ajax({
            url: '/newbie-coupon',
            method: 'post',
            data: { action: action },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    localStorage.setItem('newbie-coupon', 'true');
                    $('#newbie-modal').modal('hide');
                }
            }
        });
    });

    // Coupon code
    $(document).on('submit', '#coupon-form', function(e) {
        e.preventDefault();
        getNewbieCoupon();
    });

    /*** Carousel sliders ***/
    // Owl Carousel navigation icons
    const prevIcon = '<img src="../../img/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
    const nextIcon = '<img src="../../img/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';
    const prev = '<img src="../../img/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
    const next = '<img src="../../img/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';
    $('.target-gifts').owlCarousel({
        loop: false,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        responsive: {
            0: {
                items: 1,
                dots: true,
            },
            320: {
                items: 2,
                dots: true,
            },
            576: {
                items: 2,
                dots: false,
            },
            768: {
                items: 3,
                dots: false,
            },
            992: {
                items: 4,
                dots: false,
            },
            1024: {
                items: 4,
                dots: false,
            },
            1200: {
                items: 6,
                dots: false,
            }
        },
        autoplay: false
    });
    $('.carousel-autoplay').owlCarousel({
        loop: true,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        lazyLoad: true,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 4
            },
            1024: {
                items: 4
            },
            1200: {
                items: 6
            }
        },
        autoplay: true
    });
    $('.reviews-carousel').owlCarousel({
        loop: true,
        stagePadding: 50,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 1
            },
            576: {
                items: 1
            },
            768: {
                items: 2
            },
            992: {
                items: 2
            },
            1024: {
                items: 2
            },
            1200: {
                items: 3
            }
        },
        autoplay: false
    });
    $('.category-filters').owlCarousel({
        loop: false,
        stagePadding: 10,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        nav: true,
        navText: [
            prev,
            next
        ],
        dots: false,
        responsive: {
            0: {
                items: 2
            },
            320: {
                items: 2
            },
            576: {
                items: 4
            },
            768: {
                items: 4
            },
            992: {
                items: 5
            },
            1024: {
                items: 5
            },
            1200: {
                items: 7
            }
        },
        autoplay: false
    });
    $('.showcase-carousel').owlCarousel({
        loop: true,
        navRewind: true,
        nav: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        autoplay: true,
        items: 1,
        responsive: {
            0: {
                dots: true
            },
            320: {
                dots: true
            },
            576: {
                dots: true
            },
            768: {
                dots: false
            },
            992: {
                dots: false
            },
            1024: {
                dots: false
            },
            1200: {
                dots: false
            }
        },
    });
    $('.ordered-gifts').owlCarousel({
        loop: false,
        stagePadding: 50,
        margin: 10,
        stagePadding: true,
        smartSpeed: 450,
        dots: true,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 3
            },
            1024: {
                items: 3
            },
            1200: {
                items: 3
            }
        },
        autoplay: false
    });
    /*** /.Carousel sliders ***/
});

// Scroll to the bottom of the page
function scrollToBottom() {
    $('html, body').animate({
        scrollTop: document.body.scrollHeight
    }, 'slow');
}

// Comparison actions
function comparisons() {
    // Loop through all filled product-panes to enable the submit button
    products = document.querySelectorAll('.filled');
    if (products !== '') {
        for (var i = 0; i < products.length; i++) {
            if (i == 0) {
                $('.comparison-pane').removeClass('d-none hide');
            }
            if (i == 1) {
                $('#submit-comparisons').attr('disabled', false);
            }
            if (i > 1) {
                $('.compare-btn').attr('disabled', true);
                // Scroll to the bottom of the page if there're products to compare
                scrollToBottom();
            }
            if (i >= 2) {
                iziToast.show({
                    theme: 'dark',
                    timeout: 5000,
                    closeOnClick: true,
                    close: false,
                    progressBar: false,
                    backgroundColor: 'var(--dark-blue)',
                    icon: 'ion-information-circled text-white-inverse',
                    message: 'Only max. 3 comparisons allowed',
                    messageColor: 'var(--white-inverse)',
                    position: 'topCenter'
                });
            }
        }
    } else {
        clearComparisons();
    }
}

// Remove gift comparison from the comparison session
function removeComparison(gift_id) {
    var product = document.querySelector('#product-pane' + gift_id);
    // Replace the product's pane with the placeholder plane
    const placeholder_pane = document.createElement('div');
    placeholder_pane.classList = 'product-pane empty box-shadow-sm';
    placeholder_pane.innerHTML = `
        <div class="empty-content text-center p-2">
            <p class="text-sm mb-0 pb-0 text-white">
                Add product to compare
            </p>
            <div class="row justify-content-center">
                <div class="d-flex align-items-center text-white rounded-0 mt-1">
                    <i class="material-icons mr-1">compare_arrows</i> Compare
                </div>
            </div>
        </div>
    `;
    let gift_pane = document.querySelector('.compare-products');
    gift_pane.replaceChild(placeholder_pane, product);
    // remove the product item form the comparison session
    var action = 'remove-comparison';
    $('.compare-btn').attr('disabled', false);
    $('#compare-btn' + gift_id).removeClass('active');
    $('#compare-btn' + gift_id).html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
    $.ajax({
        url: '/remove_comparison',
        method: 'post',
        data: {
            action: action,
            gift_id: gift_id
        },
        dataType: 'json',
        success: function() {}
    });
}

// Clear the comparison session
function clearComparisons() {
    if ($('.comparison-pane').hasClass('hide')) {
        $('.comparison-pane').removeClass('hide');
        $('.comparison-pane').addClass('d-none');
        $('#submit-comparisons').attr('disabled', true);
    } else {
        $('.comparison-pane').addClass('hide d-none');
        $('#submit-comparisons').attr('disabled', true);
    }
    $('.compare-btn').attr('disabled', false);
    closePanes();
    var action = 'clear-comparisons';
    $.ajax({
        url: '/clear_comparisons',
        method: 'get',
        data: {
            action: action
        },
        dataType: 'json',
        success: function() {}
    });

    function closePanes() {
        $('.compare-btn').removeClass('active');
        $('.compare-btn').html('<i class="material-icons text-primary mr-1">compare_arrows</i> Compare');
        // Remove all filled product panes
        const gift_panes = document.querySelectorAll('.filled');
        for (const gift_pane of gift_panes) {
            // Replace the product pane with the placeholder plane
            const placeholder_pane = document.createElement('div');
            placeholder_pane.classList = 'product-pane empty box-shadow-sm';
            placeholder_pane.innerHTML = `
            <div class="empty-content text-center p-2">
                <p class="text-sm mb-0 pb-0 text-white">
                    Add product to compare
                </p>
                <div class="row justify-content-center">
                    <div class="d-flex align-items-center text-white rounded-0 mt-1">
                        <i class="material-icons mr-1">compare_arrows</i> Compare
                    </div>
                </div>
            </div>
        `;
            const compare_panel = document.querySelector('.compare-products');
            compare_panel.replaceChild(placeholder_pane, gift_pane);
        }
    }
}

// Clear cart animation
function emptyGiftBox() {
    $('#empty-giftbox-modal').modal('show');
    setTimeout(function() {
        $('#empty-giftbox-modal').modal('hide');
    }, 3000);
}

// File uploading
function progressHandler(e) {
    var upload_pcnt = (e.loaded / e.total) * 100;
    var percentage = Math.round(upload_pcnt);
    $('#uploaded-status').html(percentage + '%');
    $('#progress-upload').attr('aria-valuenow', percentage);
    $('#progress-upload').css('width', percentage + '%');
}

function completeHandler(e) {
    if (e.target.responseText == 'success') {
        $('.upload-progress-modal').modal('hide');
        resetFileUpload();
        $('#animation-title').text('Custom image added!');
        setTimeout(customizationAnime(), 1000);
        refreshPages();
    } else {
        $('.upload-progress-modal').modal('hide');
        iziToast.warning({
            theme: 'dark',
            timeout: 5000,
            closeOnClick: true,
            close: false,
            progressBar: false,
            backgroundColor: 'var(--warning)',
            icon: 'ion-android-alert text-dark',
            message: 'Oops! File upload failed!',
            messageColor: '#000',
            position: 'topCenter'
        });
    }
}

function errorHandler(e) {
    iziToast.warning({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--warning)',
        icon: 'ion-android-alert text-dark',
        message: 'Oops! File upload failed!',
        messageColor: '#000',
        position: 'topCenter'
    });
}

function abortHandler(e) {
    iziToast.warning({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--warning)',
        icon: 'ion-android-alert text-dark',
        message: 'Oops! File upload aborted!',
        messageColor: '#000',
        position: 'topCenter'
    });
}

function resetFileUpload() {
    $('#customization-form').removeClass('was-validated');
    $('#customization-form')[0].reset();
    $('#customizing-modal').modal('hide');
    $('#uploaded-status').html('100%');
    $('#progress-upload').attr('aria-valuenow', 0);
    $('#progress-upload').css('width', '0%');
    $('#custom-img').attr('src', '');
    $('#upload-file').hide();
    // Make sure the submit button is hidden and the step button is show
    $('.next-section-btn').removeClass('d-none');
    $('#next-btn-text').text('Get Started');
    $('.first-step').removeClass('d-none');
    $('.second-step').addClass('d-none');
    $('#add-custom-text').addClass('d-none');
    $('#add-custom-text').addClass('d-none');
    $('.formatting-tools-panel').addClass('d-none');
    $('#previous-btn').addClass('d-none');
}

// Fetch newbie's coupon
function getNewbieCoupon() {
    var action = 'coupon';
    var coupon_code = $('#coupon').val();
    var usd_subtotal = $('#cart-usd-subtotal').val();
    var zar_subtotal = $('#cart-zar-subtotal').val();
    var zwl_subtotal = $('#cart-zwl-subtotal').val();
    $.ajax({
        url: '/verify_coupon',
        method: 'post',
        data: {
            action: action,
            coupon_code: coupon_code,
            usd_subtotal: usd_subtotal,
            zar_subtotal: zar_subtotal,
            zwl_subtotal: zwl_subtotal
        },
        dataType: 'json',
        success: function(data) {
            shoppingCart()
        }
    });
}

// Refresh current page
function reloadPage() {
    location.reload();
}

// Refresh all gift fetches
function refreshPages() {
    showcase();
}

// Details page animations
function customizationAnime() {
    $('#accessory-animation-modal').modal('show');
    setTimeout(() => {
        $('#accessory-animation-modal').modal('hide');
    }, 3000);
}

function shoppingCart() {
    var action = 'shopping-cart';
    $.ajax({
        url: '/shopping_cart',
        method: 'get',
        data: { action: action },
        dataType: 'json',
        success: function(data) {
            if (data.message == 'success') {
                var usd_subtotal = data.usd_subtotal;
                var zar_subtotal = data.zar_subtotal;
                var zwl_subtotal = data.zwl_subtotal;
                var usd_delivery_cost = data.usd_delivery_cost;
                var zar_delivery_cost = data.zar_delivery_cost;
                var zwl_delivery_cost = data.zwl_delivery_cost;
                var usd_discount = data.usd_discount;
                var zar_discount = data.zar_discount;
                var zwl_discount = data.zwl_discount;
                var usd_total = data.usd_total;
                var zar_total = data.zar_total;
                var zwl_total = data.zwl_total;
                var count_cart = data.count_cart;

                if (count_cart > 0) {
                    $('.gift-count').text(count_cart);
                    $('.basket-info').removeClass('d-none');
                    $('#shopping-cart').attr('title', 'Click to view your ' + count_cart + ' gift(s)');
                    $('#coupon-form').removeClass('d-none');
                    $('.form-box').removeClass('d-none');
                    $('#cart-action-btns').removeClass('d-none');
                    $('.giftbox-empty').addClass('d-none');
                    $('.giftbox-filled').removeClass('d-none');
                    $('.dropdown-menu>.shopping-bag:first-child').css('margin-top', '42px');
                } else {
                    $('.dropdown-menu>.shopping-bag:first-child').css('margin-top', 0);
                    $('.giftbox-empty').removeClass('d-none');
                    $('.giftbox-filled').addClass('d-none');
                    $('#shopping-cart').attr('title', 'Your giftbox is empty!');
                    $('.gift-count').text('');
                    $('.basket-info').addClass('d-none');
                    $('.additional-charges').css('display', 'none');
                    $('#coupon-form').addClass('d-none');
                    $('.form-box').addClass('d-none');
                    $('#cart-action-btns').addClass('d-none');
                }

                // Hidden inputs
                $('#cart-usd-subtotal').val(usd_subtotal);
                $('#cart-zar-subtotal').val(zar_subtotal);
                $('#cart-zwl-subtotal').val(zwl_subtotal);
                $('#cart-usd-total').val(usd_total);
                $('#cart-zar-total').val(zar_total);
                $('#cart-zwl-total').val(zwl_total);

                // Cart outputs
                $('.usd-subtotal').text('$' + usd_subtotal);
                $('.zar-subtotal').text('R' + zar_subtotal);
                $('.zwl-subtotal').text('$' + zwl_subtotal);
                $('.usd-delivery-cost').text('$' + usd_delivery_cost);
                $('.zar-delivery-cost').text('R' + zar_delivery_cost);
                $('.zwl-delivery-cost').text('$' + zwl_delivery_cost);
                $('.usd-discount').text('$' + usd_discount);
                $('.zar-discount').text('R' + zar_discount);
                $('.zwl-discount').text('$' + zwl_discount);
                $('.usd-total').text('$' + usd_total);
                $('.zar-total').text('R' + zar_total);
                $('.zwl-total').text('$' + zwl_total);
                $('.cart-count').text(count_cart);
                $('.shopping-bag').html(data.shopping_cart);
                $('#cart-items').html(data.cart_items);
                userCurrency();
            } else {
                $('#cart-items').html(error);
            }
        }
    });
}

// Adding an item into cart
function addToCart(gift_id, gift_name, gift_image, usd_price, zar_price, zwl_price,
    sale_end_time, gift_quantity, gift_units, category_name) {
    var action = 'add-item';
    if (gift_quantity > 0) {
        $.ajax({
            url: '/add_to_cart/' + gift_id,
            method: 'get',
            data: {
                gift_id: gift_id,
                gift_name: gift_name,
                gift_image: gift_image,
                usd_price: usd_price,
                zar_price: zar_price,
                zwl_price: zwl_price,
                sale_end_time: sale_end_time,
                gift_quantity: gift_quantity,
                gift_units: gift_units,
                category_name: category_name,
                action: action
            },
            dataType: 'json',
            success: function(data) {
                if (data.message === 'success') {
                    shoppingCart();
                    $('#item-count' + gift_id).text(data.item_count);
                }
            }
        });
    }
}

// Subtract a product from the cart
function subtractFromCart(gift_id) {
    var action = 'decrease-qty';
    gift_quantity = parseInt($('#item-count' + gift_id).text());
    if (gift_quantity > 0) {
        $.ajax({
            url: '/subtract_item/' + gift_id,
            method: 'get',
            data: {
                action: action,
                gift_id: gift_id,
                gift_quantity: gift_quantity
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    shoppingCart();
                    $('#item-count' + gift_id).text(data.item_count);
                }
            }
        });
    } else {
        // Remove an item from the cart
        removeItem(gift_id);
    }
}

// Remove an item from the cart
function removeItem(gift_id) {
    var action = 'remove-item';
    $.ajax({
        url: '/remove_item/' + gift_id,
        method: 'get',
        data: {
            gift_id: gift_id,
            action: action
        },
        dataType: 'json',
        success: function(data) {
            if (data.message == 'success') {
                shoppingCart();
                $('#item-count' + gift_id).text(data.item_count);
            }
        }
    });
}

// Clear the cart
function clearCart() {
    var action = 'clear-cart';
    Swal.fire({
        title: 'Empty giftbox?',
        text: "Are you sure you want to empty your giftbox? All your gift customizations will be deleted.",
        icon: 'warning',
        backdrop: 'swal2-backdrop-show',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, empty giftbox!'
    }).then((result) => {
        if (result.value) {
            $.ajax({
                url: '/clear_cart',
                method: 'get',
                data: {
                    action: action
                },
                dataType: 'json',
                success: function(data) {
                    if (data.message == 'success') {
                        shoppingCart();
                        $('#shopping-cart').attr('title', 'Your giftbox is empty!');
                        emptyGiftBox();
                    }
                }
            });
        }
    });
}

// Sale countdown timer
function countdownTimer(gift_id, countdown_date, now) {
    gift_id = parseInt(gift_id);
    countdown_date = parseInt(countdown_date);
    now = parseInt(now);
    // Update the countdown every second
    var x = setInterval(() => {
        now += 1000;

        // Find the difference between now and the countdown date
        var diff = countdown_date - now;

        // Time calculation for days, hours, minutes and seconds
        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        var hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        var secs = Math.floor((diff % (1000 * 60)) / 1000);

        // Output the result in the gifts countdown-timer
        $('#countdown-timer' + gift_id).html(`${days}d:${hrs}h:${mins}m:${secs}s`);

        // If  the countdown is over, send an ajax request to update the gifts price
        if (diff < 0) {
            clearInterval(x);
            $('#countdown-timer' + gift_id).html('Sale closed');
        }
    }, 1000);
}

// Force numeric
function forceNumeric() {
    var input = $(this);
    input.val(input.val().replace(/[^\d+(\.\d{1,2})?$]+/, ''));
}

// Fetch all gift categories
function showcase() {
    var action = 'showcase';
    $.ajax({
        url: '/showcase',
        method: 'get',
        data: {
            action: action
        },
        dataType: 'json',
        cache: true,
        processData: true,
        success: function(data) {
            if (data.message == 'success') {
                $('#customizable-gifts').html(data.customized_gifts);
                $('#kitchenware').html(data.kitchenware);
                $('#personal-care-gifts').html(data.personal_care);
                $('#plasticware').html(data.plasticware);
                $('#combo-gifts').html(data.combo_gifts);
                $('#appliances').html(data.appliances);
                countdownTimer(data.gift_ids, data.countdown_date, data.now);
            }
        }
    });
}

// Fetch user's profile details
function userProfile() {
    var action = 'user-profile';
    $.ajax({
        url: '/account/data',
        method: 'post',
        data: {
            action: action
        },
        dataType: 'json',
        success: function(data) {
            $('#user-data').html(data.user_data);
            $('#gift-reviews').html(data.gift_reviews);
            $('.count-user-reviews').text(data.count_reviews);
        }
    });
}

// Check if user current password is the same with the registered one
function checkPassword(obj) {
    var password = obj.value;
    var action = 'check-password';

    if (password.length > 0) {
        $.ajax({
            url: '/account/check_password',
            method: 'post',
            data: {
                action: action,
                password: password
            },
            success: function(data) {
                if (data.message == 'correct') {
                    $('#change-password').removeClass('was-validated');
                    $('#password').removeClass('is-invalid');
                    $('#password').addClass('is-valid');
                    $('#password-error').hide();
                    $('.new-credentials').slideToggle('slow');
                    $('#change-password-btn').attr('type', 'submit');
                } else {
                    $('#password').addClass('is-invalid');
                    $('#password').removeClass('is-valid');
                    $('#password-error').removeClass('valid-feedback');
                    $('#password-error').addClass('invalid-feedback');
                    $('#password-error').text('Password is incorrect!');
                    $('#password-error').show();
                }
            }
        });
    } else {
        $('#password-error').removeClass('valid-feedback');
        $('#password-error').addClass('invalid-feedback');
        $('#password-error').show();
    }
}

// Newletter subscription
function subscribe(obj) {
    var subscribed = obj.checked;
    if (subscribed) {
        var action = 'subscribe';
        $.ajax({
            url: '/maiing_list',
            method: 'post',
            data: {
                action: action
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    localStorage.setItem('newsletter', 'subscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'You\'ve successfully subscribed to our newsletter!',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    } else {
        var action = 'unsubscribe';
        $.ajax({
            url: '/unsubscribe',
            method: 'post',
            data: {
                action: action
            },
            dataType: 'json',
            success: function(data) {
                if (data.message == 'success') {
                    localStorage.setItem('newsletter', 'unsubscribed');
                    iziToast.show({
                        theme: 'dark',
                        timeout: 5000,
                        overlay: false,
                        icon: 'ion ion-checkmark text-light',
                        backgroundColor: 'var(--success)',
                        message: 'Your newsletter subscription is cancelled.',
                        position: 'center'
                    });
                } else {
                    iziToast.warning({
                        theme: 'dark',
                        timeout: 5000,
                        closeOnClick: true,
                        close: false,
                        progressBar: false,
                        backgroundColor: 'var(--warning)',
                        icon: 'ion-android-alert text-dark',
                        message: 'Hmmm...Something went wrong!',
                        messageColor: '#000',
                        position: 'center'
                    });
                }
            }
        });
    }
}

// Product Preloader
function giftsPreloader(limit) {
    var output = '';
    for (var i = 0; i < limit; i++) {
        output += `
            <!-- Product Placeholder Card -->
            <div class="card placeholder-card bg-whitesmoke border-0 rounded-0 box-shadow-sm">
                <div class="img-wrapper-placeholder">
                    <div class="placeholder-label"></div>
                    <div class="placeholder-img"></div>
                </div>
                <hr class="grid-view-hr my-0 py-0">
                <div class="placeholder-card-content">
                    <div class="card-body placeholder-body m-0 p-0">
                        <div class="content-placeholder title-placeholder mt-1 ml-2"></div>
                        <div class="content-placeholder category-placeholder my-1 ml-2"></div>
                        <div class="d-flex align-items-center">
                            <div class="content-placeholder rating-placeholder ml-2"></div>
                            <div class="content-placeholder review-placeholder ml-2"></div>
                        </div>
                        <div class="content-placeholder description-placeholder mt-2 mb-1 mx-2"></div>
                        <div class="content-placeholder half-description-placeholder ml-2"></div>
                        <div class="d-flex align-items-center justify-content-between mt-2">
                            <div class="content-placeholder price-placeholder mr-2 ml-2"></div>
                            <div class="content-placeholder before-price-placeholder mr-2"></div>
                        </div>
                        <div class="text-center w-100 mx-0 px-0 mb-1">
                            <div class="btn-group btn-group-sm mt-0 pt-0 btn-group-placeholder pulse">
                                <button class="btn btn-sm btn-cart-placeholder rounded-left"></button>
                                <button class="btn btn-sm compare-btn-placeholder rounded-right"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.Product Placeholder Card -->
        `;
    }
    $('.gifts-preloader').html(output);
}

// Related gifts preloader
function relatedPreloader(limit) {
    let output = '';
    for ($i = 0; $i < limit; $i++) {
        output += `
            <!-- Related Gifts Placeholder -->
            <div class="related-gift placeholder-card card bg-whitesmoke box-shadow-sm rounded-0 border-0 w-100">
                <div class="placeholder-relative-img"></div>
                <div class="gift-content mx-1">
                    <div class="placeholder-title content-placeholder"></div>
                    <div class="d-inline-block w-100 lh-100">
                        <div class="gift-count-placeholder content-placeholder"></div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between w-100">
                        <div class="gift-rating-placeholder content-placeholder"></div>
                        <div class="gift-rating-placeholder content-placeholder mr-2"></div>
                    </div>
                    <div class="price-range-placeholder mt-1 content-placeholder"></div>
                </div>
            </div>
            <!-- /.Related Gifts Placeholder -->
        `;
    }
    $('#gift-categories').html(output);
}

// Limit number of text characters
function limitArticleDesc(selector, maxLength) {
    $(selector).html((i, txt) => txt.length > maxLength ? txt.substr(0, maxLength) + '...<p class="text-left font-600 mt-2"><a href="">Read full article</a></p>' : txt);
};

limitProdDesc('.comparison-title', 17);

function limitProdDesc(selector, maxLength) {
    $(selector).html((i, txt) => txt.length > maxLength ? txt.substr(0, maxLength) + '...' : txt);
};

function userTheme() {
    if ($('body').hasClass('darkmode')) {
        // Change the theme to default
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        $('.theme-switch').attr('checked', false);
        localStorage.setItem('theme', 'default');
    } else {
        // Change to darkmode
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    }
}

// Toggling between the dark and light mode
function themeMode(obj) {
    var darkmode = obj.checked;
    if (darkmode) {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    } else {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'default');
        $('.theme-switch').attr('checked', false);
    }
}

// Displaying gifts according to user's preference
function viewOption() {
    let view_option = localStorage.getItem('view-option');

    // Toggle the view option to list-view on mobile phones
    if (window.innerWidth < 768) {
        localStorage.setItem('view-option', 'list-view');
        $('.grid-icon').removeClass('active');
        $('.list-icon').addClass('active');
        $('.products-shelf').removeClass('grid-view');
        $('.gifts-preloader').removeClass('grid-view');
        $('.products-shelf').addClass('list-view');
        $('.gifts-preloader').addClass('list-view');
    } else {
        if (view_option !== null) {
            if (view_option === 'grid-view') {
                $('.grid-icon').addClass('active');
                $('.list-icon').removeClass('active');
                if ($('.products-shelf').hasClass('grid-view') && ($('.gifts-preloader').hasClass('grid-view'))) {
                    $('.products-shelf').removeClass('list-view');
                    $('.gifts-preloader').removeClass('list-view');
                } else {
                    $('.products-shelf').removeClass('list-view');
                    $('.gifts-preloader').removeClass('list-view');
                    $('.products-shelf').addClass('grid-view');
                    $('.gifts-preloader').addClass('grid-view');
                }
            } else if (view_option === 'list-view') {
                $('.grid-icon').removeClass('active');
                $('.list-icon').addClass('active');
                if ($('.products-shelf').hasClass('list-view') && $('.gifts-preloader').hasClass('list-view')) {
                    $('.products-shelf').removeClass('grid-view');
                    $('.gifts-preloader').removeClass('grid-view');
                } else {
                    $('.products-shelf').removeClass('grid-view');
                    $('.gifts-preloader').removeClass('grid-view');
                    $('.products-shelf').addClass('list-view');
                    $('.gifts-preloader').addClass('list-view');
                }
            }
        } else {
            $('.grid-icon').addClass('active');
            $('.list-icon').removeClass('active');
            $('.products-shelf').removeClass('list-view');
            $('.gifts-preloader').removeClass('list-view');
        }
    }
}

// Fetch user's name ordering
function nameOrdering() {
    var name_ordering = localStorage.getItem('name-sorting-order');
    var name_sorting;
    if (name_ordering) {
        if (name_ordering == 'asc') {
            name_sorting = 'asc';
            $('#name-asc').attr('checked', true);
        } else {
            name_sorting = 'desc';
            $('#name-asc').attr('checked', false);
        }
    } else {
        name_sorting = 'asc';
    }
    return name_sorting;
}

// Toggling sorting gifts by their name order (ASC or DESC)
function orderByName(obj) {
    var asc = obj.checked;
    if (asc) {
        $('#name-sorting-order').text('Ascending');
        localStorage.setItem('name-sorting-order', 'asc');
    } else {
        $('#name-sorting-order').text('Descending');
        localStorage.setItem('name-sorting-order', 'desc');
    }
}

// Fetch user's price ordering
function priceOrdering() {
    var price_ordering = localStorage.getItem('price-sorting-order');
    var price_sorting;
    if (price_ordering) {
        if (price_ordering == 'asc') {
            price_sorting = 'asc';
            $('#price-sorting').val('asc');
            $('#price-ordering-label').text('Ascending');
            $('#price-ordering').attr('checked', true);
        } else {
            price_sorting = 'desc';
            $('#price-sorting').val('desc');
            $('#price-ordering-label').text('Descending');
            $('#price-ordering').attr('checked', false);
        }
    } else {
        price_sorting = 'asc';
    }
    return price_sorting;
}

// Toggling sorting gifts by their price order (ASC or DESC)
function orderByPrice(obj) {
    price_ordering = obj.checked;
    if (price_ordering) {
        $('#price-ordering-label').text('Ascending');
        localStorage.setItem('price-sorting-order', 'asc');
        location.reload();
    } else {
        $('#price-ordering-label').text('Descending');
        localStorage.setItem('price-sorting-order', 'desc');
        location.reload();
    }
}

// Fetch user's currency
function userCurrency() {
    // Determine user currency setting
    var user_currency = '';
    var currency = localStorage.getItem('currency');
    if (currency) {
        if (currency == 'usd') {
            user_currency = 'usd';
            $('.usd-currency').attr('checked', true);
            $('.zar-currency').attr('checked', false);
            $('.zwl-currency').attr('checked', false);
            $('.usd-price').removeClass('d-none');
            $('.zar-price').addClass('d-none');
            $('.zwl-price').addClass('d-none');
            $('#currency').val('usd');
            $('#min-price').attr('placeholder', 'US$Min');
            $('#max-price').attr('placeholder', 'US$Max');
        } else if (currency == 'zar') {
            user_currency = 'zar';
            $('.usd-currency').attr('checked', false);
            $('.zar-currency').attr('checked', true);
            $('.zwl-currency').attr('checked', false);
            $('.usd-price').addClass('d-none');
            $('.zar-price').removeClass('d-none');
            $('.zwl-price').addClass('d-none');
            $('#currency').val('zar');
            $('#min-price').attr('placeholder', 'ZARMin');
            $('#max-price').attr('placeholder', 'ZARMax');
        } else if (currency == 'zwl') {
            user_currency = 'zwl';
            $('.usd-currency').attr('checked', false);
            $('.zar-currency').attr('checked', false);
            $('.zwl-currency').attr('checked', true);
            $('.usd-price').addClass('d-none');
            $('.zar-price').addClass('d-none');
            $('.zwl-price').removeClass('d-none');
            $('#currency').val('zwl');
            $('#min-price').attr('placeholder', 'ZW$Min');
            $('#max-price').attr('placeholder', 'ZW$Max');
        }
    } else {
        user_currency = 'usd';
        $('.usd-currency').attr('checked', true);
        $('.zar-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
    return user_currency;
}

// Toggle usd currency
function usdCurrency(obj) {
    var usd_currency = obj.checked;
    if (usd_currency === true) {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    } else {
        $('.zar-currency').attr('checked', 'checked');
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').addClass('d-none');
        $('.zar-price').removeClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'zar');
        $('#currency').val('zar');
        $('#min-price').attr('placeholder', 'ZARMin');
        $('#max-price').attr('placeholder', 'ZARMax');
    }
}

// Toggle zar currency
function zarCurrency(obj) {
    var zar_currency = obj.checked;
    if (zar_currency === true) {
        $('.zar-currency').attr('checked', 'checked');
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').addClass('d-none');
        $('.zar-price').removeClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'zar');
        $('#currency').val('zar');
        $('#min-price').attr('placeholder', 'ZARMin');
        $('#max-price').attr('placeholder', 'ZARMax');
    } else {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
}

// Toggle zar currency
function zwlCurrency(obj) {
    var zwl_currency = obj.checked;
    if (zwl_currency === true) {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', false);
        $('.zwl-currency').attr('checked', true);
        $('.usd-price').addClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').removeClass('d-none');
        localStorage.setItem('currency', 'zwl');
        $('#currency').val('zwl');
        $('#min-price').attr('placeholder', 'ZW$Min');
        $('#max-price').attr('placeholder', 'ZW$Max');
    } else {
        $('.zar-currency').attr('checked', false);
        $('.usd-currency').attr('checked', true);
        $('.zwl-currency').attr('checked', false);
        $('.usd-price').removeClass('d-none');
        $('.zar-price').addClass('d-none');
        $('.zwl-price').addClass('d-none');
        localStorage.setItem('currency', 'usd');
        $('#currency').val('usd');
        $('#min-price').attr('placeholder', 'US$Min');
        $('#max-price').attr('placeholder', 'US$Max');
    }
}

// Toggle usd currency zimswitch
function usDollar() {
    $('.zar-currency').attr('checked', false);
    $('.usd-currency').attr('checked', true);
    $('.zwl-currency').attr('checked', false);
    $('.usd-price').removeClass('d-none');
    $('.zar-price').addClass('d-none');
    $('.zwl-price').addClass('d-none');
    localStorage.setItem('currency', 'usd');
    $('#currency').val('usd');
    $('#min-price').attr('placeholder', 'US$Min');
    $('#max-price').attr('placeholder', 'US$Max');
}

// Toggle zar currency
function zaRand() {
    $('.zar-currency').attr('checked', 'checked');
    $('.usd-currency').attr('checked', false);
    $('.zwl-currency').attr('checked', false);
    $('.usd-price').addClass('d-none');
    $('.zar-price').removeClass('d-none');
    $('.zwl-price').addClass('d-none');
    localStorage.setItem('currency', 'zar');
    $('#currency').val('zar');
    $('#min-price').attr('placeholder', 'ZARMin');
    $('#max-price').attr('placeholder', 'ZARMax');
}

// Toggle zar currency
function zwBond() {
    $('.zar-currency').attr('checked', false);
    $('.usd-currency').attr('checked', false);
    $('.zwl-currency').attr('checked', true);
    $('.usd-price').addClass('d-none');
    $('.zar-price').addClass('d-none');
    $('.zwl-price').removeClass('d-none');
    localStorage.setItem('currency', 'zwl');
    $('#currency').val('zwl');
    $('#min-price').attr('placeholder', 'ZW$Min');
    $('#max-price').attr('placeholder', 'ZW$Max');
}

// Details page animations
function customizationAnime() {
    $('#accessory-animation-modal').modal('show');
    setTimeout(() => {
        $('#accessory-animation-modal').modal('hide');
    }, 3000);
}

//Click profile avatar placeholder to upload file
function triggerClick() {
    $('#profile-pic').on('click');
}

function displayImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('.prof-pic').attr('src', e.target.result);
        }
        reader.readAsDataURL(e.files[0]);
    }
}

//Click to change cover page
function changeCoverPic() {
    $('#cover-img').on('click');
}

function displayCoverImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('.cover-page').attr('src', e.target.result);
        }
        reader.readAsDataURL(e.files[0]);
    }
}

// Upload gift custom image
function selectCustomImg() {
    $('#gift-custom-img').on('click');;
}

function showCustomImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            // Show the uploaded image
            $('#toggle-custom-settings').removeClass('d-none');
            $('.card-info-icon').html('');
            $('.card-info-text').html('Click to change custom image');
            $('#user-custom-file').attr('src', e.target.result);
            $('.uploaded-custom-img').attr('src', e.target.result);
            $('#toggle-custom-settings').removeClass('d-none');
            $('#save-changes-btn').removeAttr('disabled');
        }
        reader.readAsDataURL(e.files[0]);
    } else {
        $('#toggle-custom-settings').addClass('d-none');
        $('#toggle-custom-settings').addClass('d-none');
        $('#save-changes-btn').attr('disabled', true);
    }
}

// Fetch user's details
function userInfo() {
    var action = 'user-info';
    $.ajax({
        url: '/user_info',
        method: 'get',
        data: {
            action: action
        },
        dataType: 'json',
        success: function(data) {
            $('#count-wishlist').html(data.count_wishlist);
            if (data.count_wishlist == 0) {
                $('#count-wishlist').text('');
            } else if (data.count_wishlist == 1) {
                $('#wishlist-text').html('You\'ve <span class="badge badge-primary">1</span> item in your Wishlist');
                $('.wishlist').attr('title', '1 item in your Wishlist');
            } else if (data.count_wishlist > 1) {
                $('.wishlist').attr('title', data.count_wishlist + ' items in your Wishlist');
                $('#wishlist-text').html('You\'ve <span class="badge badge-primary">' + data.count_wishlist + '</span> items in your Wishlist');
            }
            var birth_date = data.birth_date;
            var birthday = ("0" + birth_date).slice(-2);
            var birth_month = `${data.birth_month}`;
            var birth_year = data.birth_year;
            $('.birthday-date').val(birthday);
            $('.birth-month').val(birth_month);
            $('.birth-year').val(birth_year);
        }
    });
}

// Fetch users wishlist data and display
function myWishlist() {
    var action = 'my-wishlist';
    $.ajax({
        url: '/wishlist/display',
        method: 'get',
        data: {
            action: action
        },
        dataType: 'json',
        success: function(data) {
            $('#saved-gifts').html(data.saved_gifts);
            $('#wishlist').html(data.wishlist);
        }
    });
}

// Diable the submit button if there's no review text
function emptyReview(obj) {
    var review = obj.value;
    if (review.length > 0) {
        $('#submit-review').attr('disabled', false);
    } else {
        $('#submit-review').attr('disabled', true);
    }
}

// Fetch all user's notifications
function notifications(status = '') {
    $.ajax({
        url: '/notifications',
        method: 'get',
        data: {
            status: status
        },
        dataType: 'json',
        success: function(data) {
            $('#notifications').html(data.notifications);
            if (data.count > 0) {
                document.title = data.notification;
                $('.notifications-counter').text(data.count);
                $('.notifications').toggleClass('animated swing infinite');
                $('.notification-link').attr('title', data.count + ' New Notification(s)');
            } else {
                $('.notification-link').attr('title', 'No New Notifications');
                $('.notifications').removeClass('animated swing infinite');
            }
        }
    });
}

// SweetAlerts
function updates() {
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    })

    Toast.fire({
        icon: 'success',
        title: 'Signed in successfully'
    })
}

// Check recipient's email
function emailValidation(obj) {
    var email = obj.value;
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;

    if (email == '') {
        if ($('#emailError').hasClass('is-invalid')) {
            $('#emailError').text('Email address required');
        } else {
            $('#emailError').text('Email address required');
            $('#emailError').toggleClass('is-invalid');
        }
    } else if (emailReg.test(email)) {
        $('#emailError').hide();
    } else {
        if ($('#emailError').hasClass('is-invalid')) {
            $('#emailError').text('Email should be someone@example.com');
        } else {
            $('#emailError').text('Email should be someone@example.com');
            $('#emailError').toggleClass('is-invalid');
        }
    }
}